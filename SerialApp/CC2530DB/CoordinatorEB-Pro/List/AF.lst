###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         08/Aug/2016  14:20:26 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Users\zhuyi\Desktop\2016 µçÈü                   #
#                          ¾öÈü\8.6\Components\stack\af\AF.c                  #
#    Command line       =  -f "C:\Users\zhuyi\Desktop\2016 µçÈü               #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg"          #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"         #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Components\stack\af\AF.c" -D ZIGBEEPRO    #
#                          -D HAL_UART=TRUE -D SERIAL_APP_PORT=0 -D           #
#                          LCD_SUPPORTED -D NV_RESTORE -lC                    #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\List\" -lA                   #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\List\" --diag_suppress       #
#                          Pe001,Pa010 -o "C:\Users\zhuyi\Desktop\2016 µçÈü   #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\Obj\" -e --no_unroll         #
#                          --no_inline --no_tbaa --debug --core=plain         #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 8 -I "C:\Users\zhuyi\Desktop\201 #
#                          6 µçÈü  ¾öÈü\8.6\Projects\zstack\Utilities\SerialA #
#                          pp\CC2530DB\" -I "C:\Users\zhuyi\Desktop\2016      #
#                          µçÈü  ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp #
#                          \CC2530DB\..\SOURCE\" -I                           #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\ZMAIN\TI2530DB\" -I                   #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MT\" -I              #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\" -I     #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\ #
#                          " -I "C:\Users\zhuyi\Desktop\2016 µçÈü             #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\" -I  #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\" -I    #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\AF\" -I        #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\NWK\" -I       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\SEC\" -I       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\" -I      #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\SYS\" -I       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\" -I       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\" -I        #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\ZMAC\" -I            #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\" -I  #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA\" -I  #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\" -I     #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\" -I  #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\ #
#                          " -I "C:\Users\zhuyi\Desktop\2016 µçÈü             #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\ #
#                          SINGLE_CHIP\" -Om --require_prototypes             #
#    List file          =  C:\Users\zhuyi\Desktop\2016 µçÈü                   #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\List\AF.lst                  #
#    Object file        =  C:\Users\zhuyi\Desktop\2016 µçÈü                   #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\Obj\AF.r51                   #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\zhuyi\Desktop\2016 µçÈü  ¾öÈü\8.6\Components\stack\af\AF.c
      1          /**************************************************************************************************
      2            Filename:       AF.c
      3            Revised:        $Date: 2009-03-19 13:41:00 -0700 (Thu, 19 Mar 2009) $
      4            Revision:       $Revision: 19470 $
      5          
      6            Description:    Application Framework - Device Description helper functions
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          
     44          #include "OSAL.h"
     45          #include "AF.h"
     46          #include "nwk_globals.h"
     47          #include "nwk_util.h"
     48          #include "aps_groups.h"
     49          #include "ZDProfile.h"
     50          #include "aps_frag.h"
     51          
     52          #if defined ( MT_AF_CB_FUNC )
     53            #include "MT_AF.h"
     54          #endif
     55          
     56          #if defined ( INTER_PAN )
     57            #include "stub_aps.h"
     58          #endif
     59          
     60          /*********************************************************************
     61           * MACROS
     62           */
     63          
     64          /*********************************************************************
     65           * @fn      afSend
     66           *
     67           * @brief   Helper macro for V1 API to invoke V2 API.
     68           *
     69           * input parameters
     70           *
     71           * @param  *dstAddr - Full ZB destination address: Nwk Addr + End Point.
     72           * @param   srcEP - Origination (i.e. respond to or ack to) End Point.
     73           * @param   cID - A valid cluster ID as specified by the Profile.
     74           * @param   len - Number of bytes of data pointed to by next param.
     75           * @param  *buf - A pointer to the data bytes to send.
     76           * @param   options - Valid bit mask of AF Tx Options as defined in AF.h.
     77           * @param  *transID - A pointer to a byte which can be modified and which will
     78           *                    be used as the transaction sequence number of the msg.
     79           *
     80           * output parameters
     81           *
     82           * @param  *transID - Incremented by one if the return value is success.
     83           *
     84           * @return  afStatus_t - See previous definition of afStatus_... types.
     85           */
     86          #define afSend( dstAddr, srcEP, cID, len, buf, transID, options, radius ) \
     87                  AF_DataRequest( (dstAddr), afFindEndPointDesc( (srcEP) ), \
     88                                    (cID), (len), (buf), (transID), (options), (radius) )
     89          
     90          /*********************************************************************
     91           * CONSTANTS
     92           */
     93          
     94          /*********************************************************************
     95           * TYPEDEFS
     96           */
     97          
     98          /*********************************************************************
     99           * GLOBAL VARIABLES
    100           */
    101          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    102          epList_t *epList;
   \                     epList:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    103          
    104          /*********************************************************************
    105           * EXTERNAL VARIABLES
    106           */
    107          
    108          /*********************************************************************
    109           * EXTERNAL FUNCTIONS
    110           */
    111          
    112          /*********************************************************************
    113           * LOCAL VARIABLES
    114           */
    115          
    116          /*********************************************************************
    117           * LOCAL FUNCTIONS
    118           */
    119          
    120          static void afBuildMSGIncoming( aps_FrameFormat_t *aff, endPointDesc_t *epDesc,
    121                          zAddrType_t *SrcAddress, uint16 SrcPanId, NLDE_Signal_t *sig,
    122                          byte SecurityUse, uint32 timestamp );
    123          
    124          static epList_t *afFindEndPointDescList( byte EndPoint );
    125          
    126          static pDescCB afGetDescCB( endPointDesc_t *epDesc );
    127          
    128          /*********************************************************************
    129           * NETWORK LAYER CALLBACKS
    130           */
    131          
    132          /*********************************************************************
    133           * PUBLIC FUNCTIONS
    134           */
    135          
    136          /*********************************************************************
    137           * @fn      afInit
    138           *
    139           * @brief   Initialization function for the AF.
    140           *
    141           * @param   none
    142           *
    143           * @return  none
    144           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    145          void afInit( void )
   \                     afInit:
    146          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    147            // Start with no endpoint defined
    148            epList = NULL;
   \   000004   90....       MOV     DPTR,#epList
   \   000007   E4           CLR     A
   \   000008   F0           MOVX    @DPTR,A
   \   000009   A3           INC     DPTR
   \   00000A   F0           MOVX    @DPTR,A
    149          }
   \   00000B   D083         POP     DPH
   \   00000D   D082         POP     DPL
   \   00000F   02....       LJMP    ?BRET
    150          
    151          /*********************************************************************
    152           * @fn      afRegisterExtended
    153           *
    154           * @brief   Register an Application's EndPoint description.
    155           *
    156           * @param   epDesc - pointer to the Application's endpoint descriptor.
    157           * @param   descFn - pointer to descriptor callback function
    158           *
    159           * NOTE:  The memory that epDesc is pointing to must exist after this call.
    160           *
    161           * @return  Pointer to epList_t on success, NULL otherwise.
    162           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    163          epList_t *afRegisterExtended( endPointDesc_t *epDesc, pDescCB descFn )
   \                     afRegisterExtended:
    164          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
    165            epList_t *ep;
    166            epList_t *epSearch;
    167          
    168            ep = osal_mem_alloc( sizeof ( epList_t ) );
   \   00000D                ; Setup parameters for call to function osal_mem_alloc
   \   00000D   7A07         MOV     R2,#0x7
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   12....       LCALL   ??osal_mem_alloc?relay
    169            if ( ep )
   \   000014   EA           MOV     A,R2
   \   000015   4B           ORL     A,R3
   \   000016   605F         JZ      ??afRegisterExtended_0
    170            {
    171              // Fill in the new list entry
    172              ep->epDesc = epDesc;
   \   000018   8A82         MOV     DPL,R2
   \   00001A   8B83         MOV     DPH,R3
   \   00001C   E5..         MOV     A,?V0 + 0
   \   00001E   F0           MOVX    @DPTR,A
   \   00001F   A3           INC     DPTR
   \   000020   E5..         MOV     A,?V0 + 1
   \   000022   F0           MOVX    @DPTR,A
    173          
    174              // Default to allow Match Descriptor.
    175              ep->flags = eEP_AllowMatch;
   \   000023   8A82         MOV     DPL,R2
   \   000025   8B83         MOV     DPH,R3
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   7401         MOV     A,#0x1
   \   00002B   F0           MOVX    @DPTR,A
    176              ep->pfnDescCB = descFn;
   \   00002C   8A82         MOV     DPL,R2
   \   00002E   8B83         MOV     DPH,R3
   \   000030   A3           INC     DPTR
   \   000031   A3           INC     DPTR
   \   000032   A3           INC     DPTR
   \   000033   EE           MOV     A,R6
   \   000034   F0           MOVX    @DPTR,A
   \   000035   A3           INC     DPTR
   \   000036   EF           MOV     A,R7
   \   000037   F0           MOVX    @DPTR,A
    177              ep->nextDesc = NULL;
   \   000038   8A82         MOV     DPL,R2
   \   00003A   8B83         MOV     DPH,R3
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   A3           INC     DPTR
   \   00003F   A3           INC     DPTR
   \   000040   A3           INC     DPTR
   \   000041   E4           CLR     A
   \   000042   F0           MOVX    @DPTR,A
   \   000043   A3           INC     DPTR
   \   000044   F0           MOVX    @DPTR,A
    178          
    179              // Does a list exist?
    180              if ( epList == NULL )
   \   000045   90....       MOV     DPTR,#epList
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F8           MOV     R0,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F9           MOV     R1,A
   \   00004D   E8           MOV     A,R0
   \   00004E   49           ORL     A,R1
   \   00004F   90....       MOV     DPTR,#epList
   \   000052   601E         JZ      ??afRegisterExtended_1
    181                epList = ep;  // Make this the first entry
    182              else
    183              {
    184                // Look for the end of the list
    185                epSearch = epList;
    186                while( epSearch->nextDesc != NULL )
    187                  epSearch = epSearch->nextDesc;
   \                     ??afRegisterExtended_2:
   \   000054   E0           MOVX    A,@DPTR
   \   000055   F8           MOV     R0,A
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   F9           MOV     R1,A
   \   000059   E8           MOV     A,R0
   \   00005A   2405         ADD     A,#0x5
   \   00005C   F8           MOV     R0,A
   \   00005D   E9           MOV     A,R1
   \   00005E   3400         ADDC    A,#0x0
   \   000060   F9           MOV     R1,A
   \   000061   8882         MOV     DPL,R0
   \   000063   8983         MOV     DPH,R1
   \   000065   E0           MOVX    A,@DPTR
   \   000066   FC           MOV     R4,A
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   FD           MOV     R5,A
   \   00006A   EC           MOV     A,R4
   \   00006B   4D           ORL     A,R5
   \   00006C   8882         MOV     DPL,R0
   \   00006E   8983         MOV     DPH,R1
   \   000070   70E2         JNZ     ??afRegisterExtended_2
    188          
    189                // Add new entry to end of list
    190                epSearch->nextDesc = ep;
   \                     ??afRegisterExtended_1:
   \   000072   EA           MOV     A,R2
   \   000073   F0           MOVX    @DPTR,A
   \   000074   A3           INC     DPTR
   \   000075   EB           MOV     A,R3
   \   000076   F0           MOVX    @DPTR,A
    191              }
    192            }
    193          
    194            return ep;
   \                     ??afRegisterExtended_0:
   \   000077   7F04         MOV     R7,#0x4
   \   000079   02....       LJMP    ?BANKED_LEAVE_XDATA
    195          }
    196          
    197          /*********************************************************************
    198           * @fn      afRegister
    199           *
    200           * @brief   Register an Application's EndPoint description.
    201           *
    202           * @param   epDesc - pointer to the Application's endpoint descriptor.
    203           *
    204           * NOTE:  The memory that epDesc is pointing to must exist after this call.
    205           *
    206           * @return  afStatus_SUCCESS - Registered
    207           *          afStatus_MEM_FAIL - not enough memory to add descriptor
    208           *          afStatus_INVALID_PARAMETER - duplicate endpoint
    209           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    210          afStatus_t afRegister( endPointDesc_t *epDesc )
   \                     afRegister:
    211          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    212            epList_t *ep;
    213            
    214            // Look for duplicate endpoint
    215            if ( afFindEndPointDescList( epDesc->endPoint ) )
   \   000009                ; Setup parameters for call to function afFindEndPointDescList
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F9           MOV     R1,A
   \   00000F   12....       LCALL   ??afFindEndPointDescList?relay
   \   000012   8B..         MOV     ?V0 + 1,R3
   \   000014   EA           MOV     A,R2
   \   000015   45..         ORL     A,?V0 + 1
   \   000017   6004         JZ      ??afRegister_0
    216              return ( afStatus_INVALID_PARAMETER );
   \   000019   7902         MOV     R1,#0x2
   \   00001B   8018         SJMP    ??afRegister_1
    217            
    218            ep = afRegisterExtended( epDesc, NULL );
    219          
    220            return ((ep == NULL) ? afStatus_MEM_FAIL : afStatus_SUCCESS);
   \                     ??afRegister_0:
   \   00001D                ; Setup parameters for call to function afRegisterExtended
   \   00001D   7C00         MOV     R4,#0x0
   \   00001F   7D00         MOV     R5,#0x0
   \   000021   EE           MOV     A,R6
   \   000022   FA           MOV     R2,A
   \   000023   EF           MOV     A,R7
   \   000024   FB           MOV     R3,A
   \   000025   12....       LCALL   ??afRegisterExtended?relay
   \   000028   8B..         MOV     ?V0 + 1,R3
   \   00002A   EA           MOV     A,R2
   \   00002B   45..         ORL     A,?V0 + 1
   \   00002D   7004         JNZ     ??afRegister_2
   \   00002F   7910         MOV     R1,#0x10
   \   000031   8002         SJMP    ??afRegister_1
   \                     ??afRegister_2:
   \   000033   7900         MOV     R1,#0x0
   \                     ??afRegister_1:
   \   000035   7F02         MOV     R7,#0x2
   \   000037   02....       LJMP    ?BANKED_LEAVE_XDATA
    221          }
    222          
    223          
    224          /*********************************************************************
    225           * @fn          afDataConfirm
    226           *
    227           * @brief       This function will generate the Data Confirm back to
    228           *              the application.
    229           *
    230           * @param       endPoint - confirm end point
    231           * @param       transID - transaction ID from APSDE_DATA_REQUEST
    232           * @param       status - status of APSDE_DATA_REQUEST
    233           *
    234           * @return      none
    235           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    236          void afDataConfirm( uint8 endPoint, uint8 transID, ZStatus_t status )
   \                     afDataConfirm:
    237          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   \   000008   FF           MOV     R7,A
   \   000009   8B..         MOV     ?V0 + 0,R3
    238            endPointDesc_t *epDesc;
    239            afDataConfirm_t *msgPtr;
    240          
    241            // Find the endpoint description
    242            epDesc = afFindEndPointDesc( endPoint );
   \   00000B                ; Setup parameters for call to function afFindEndPointDesc
   \   00000B   12....       LCALL   ??afFindEndPointDesc?relay
   \   00000E   8A..         MOV     ?V0 + 4,R2
   \   000010   8B..         MOV     ?V0 + 5,R3
    243            if ( epDesc == NULL )
   \   000012   EA           MOV     A,R2
   \   000013   45..         ORL     A,?V0 + 5
   \   000015   603B         JZ      ??afDataConfirm_0
    244              return;
    245          
    246            // Determine the incoming command type
    247            msgPtr = (afDataConfirm_t *)osal_msg_allocate( sizeof(afDataConfirm_t) );
   \   000017                ; Setup parameters for call to function osal_msg_allocate
   \   000017   7A04         MOV     R2,#0x4
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??osal_msg_allocate?relay
    248            if ( msgPtr )
   \   00001E   EA           MOV     A,R2
   \   00001F   4B           ORL     A,R3
   \   000020   6030         JZ      ??afDataConfirm_0
    249            {
    250              // Build the Data Confirm message
    251              msgPtr->hdr.event = AF_DATA_CONFIRM_CMD;
   \   000022   8A82         MOV     DPL,R2
   \   000024   8B83         MOV     DPH,R3
   \   000026   74FD         MOV     A,#-0x3
   \   000028   F0           MOVX    @DPTR,A
    252              msgPtr->hdr.status = status;
   \   000029   A3           INC     DPTR
   \   00002A   E5..         MOV     A,?V0 + 0
   \   00002C   F0           MOVX    @DPTR,A
    253              msgPtr->endpoint = endPoint;
   \   00002D   EE           MOV     A,R6
   \   00002E   8A82         MOV     DPL,R2
   \   000030   8B83         MOV     DPH,R3
   \   000032   A3           INC     DPTR
   \   000033   A3           INC     DPTR
   \   000034   F0           MOVX    @DPTR,A
    254              msgPtr->transID = transID;
   \   000035   EF           MOV     A,R7
   \   000036   8A82         MOV     DPL,R2
   \   000038   8B83         MOV     DPH,R3
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   A3           INC     DPTR
   \   00003D   F0           MOVX    @DPTR,A
    255          
    256          #if defined ( MT_AF_CB_FUNC )
    257              /* If MT has subscribed for this callback, don't send as a message. */
    258              if ( AFCB_CHECK(CB_ID_AF_DATA_CNF,*(epDesc->task_id)) )
    259              {
    260                /* Send callback if it's subscribed */
    261                MT_AfDataConfirm ((void *)msgPtr);
    262                /* Release the memory. */
    263                osal_msg_deallocate( (void *)msgPtr );
    264              }
    265              else
    266          #endif
    267              {
    268                /* send message through task message */
    269                osal_msg_send( *(epDesc->task_id), (byte *)msgPtr );
   \   00003E                ; Setup parameters for call to function osal_msg_send
   \   00003E   85..82       MOV     DPL,?V0 + 4
   \   000041   85..83       MOV     DPH,?V0 + 5
   \   000044   A3           INC     DPTR
   \   000045   E0           MOVX    A,@DPTR
   \   000046   F8           MOV     R0,A
   \   000047   A3           INC     DPTR
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F583         MOV     DPH,A
   \   00004B   8882         MOV     DPL,R0
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   F9           MOV     R1,A
   \   00004F   12....       LCALL   ??osal_msg_send?relay
   \                     ??afDataConfirm_0:
   \   000052   7F06         MOV     R7,#0x6
   \   000054   02....       LJMP    ?BANKED_LEAVE_XDATA
    270              }
    271            }
    272          }
    273          
    274          /*********************************************************************
    275           * @fn          afIncomingData
    276           *
    277           * @brief       Transfer a data PDU (ASDU) from the APS sub-layer to the AF.
    278           *
    279           * @param       aff  - pointer to APS frame format
    280           * @param       SrcAddress  - Source address
    281           * @param       sig - incoming message's link quality
    282           * @param       SecurityUse - Security enable/disable
    283           *
    284           * @return      none
    285           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    286          void afIncomingData( aps_FrameFormat_t *aff, zAddrType_t *SrcAddress, uint16 SrcPanId,
   \                     afIncomingData:
    287                               NLDE_Signal_t *sig, byte SecurityUse, uint32 timestamp )
    288          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7401         MOV     A,#0x1
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   EA           MOV     A,R2
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   EB           MOV     A,R3
   \   000013   F0           MOVX    @DPTR,A
   \   000014   7406         MOV     A,#0x6
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   EC           MOV     A,R4
   \   00001A   F0           MOVX    @DPTR,A
   \   00001B   A3           INC     DPTR
   \   00001C   ED           MOV     A,R5
   \   00001D   F0           MOVX    @DPTR,A
   \   00001E   E9           MOV     A,R1
   \   00001F   C0E0         PUSH    A
   \   000021   7405         MOV     A,#0x5
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   D0E0         POP     A
   \   000028   F0           MOVX    @DPTR,A
   \   000029   741C         MOV     A,#0x1c
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?L_MOV_X
    289            endPointDesc_t *epDesc = NULL;
   \   000033   7E00         MOV     R6,#0x0
   \   000035   7F00         MOV     R7,#0x0
    290            uint16 epProfileID = 0xFFFF;  // Invalid Profile ID
   \   000037   7403         MOV     A,#0x3
   \   000039   12....       LCALL   ?XSTACK_DISP0_8
   \   00003C   74FF         MOV     A,#-0x1
   \   00003E   F0           MOVX    @DPTR,A
   \   00003F   A3           INC     DPTR
   \   000040   F0           MOVX    @DPTR,A
    291            epList_t *pList;
    292          #if !defined ( APS_NO_GROUPS )    
    293            uint8 grpEp;
    294          #endif  
    295          
    296            if ( ((aff->FrmCtrl & APS_DELIVERYMODE_MASK) == APS_FC_DM_GROUP) )
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E0           MOVX    A,@DPTR
   \   000047   F8           MOV     R0,A
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F583         MOV     DPH,A
   \   00004C   8882         MOV     DPL,R0
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   540C         ANL     A,#0xc
   \   000051   640C         XRL     A,#0xc
   \   000053   7042         JNZ     ??afIncomingData_0
    297            {
    298          #if !defined ( APS_NO_GROUPS )    
    299              // Find the first endpoint for this group
    300              grpEp = aps_FindGroupForEndpoint( aff->GroupID, APS_GROUPS_FIND_FIRST );
   \   000055                ; Setup parameters for call to function aps_FindGroupForEndpoint
   \   000055   79FE         MOV     R1,#-0x2
   \   000057   7401         MOV     A,#0x1
   \   000059   12....       LCALL   ?XSTACK_DISP0_8
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   F8           MOV     R0,A
   \   00005E   A3           INC     DPTR
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   F583         MOV     DPH,A
   \   000062   8882         MOV     DPL,R0
   \   000064   A3           INC     DPTR
   \   000065   A3           INC     DPTR
   \   000066   A3           INC     DPTR
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   FA           MOV     R2,A
   \   00006A   A3           INC     DPTR
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   FB           MOV     R3,A
   \   00006D   12....       LCALL   ??aps_FindGroupForEndpoint?relay
   \   000070   E9           MOV     A,R1
   \   000071   85..82       MOV     DPL,?XSP + 0
   \   000074   85..83       MOV     DPH,?XSP + 1
   \   000077   F0           MOVX    @DPTR,A
    301              if ( grpEp == APS_GROUPS_EP_NOT_FOUND )
   \   000078   E0           MOVX    A,@DPTR
   \   000079   64FE         XRL     A,#0xfe
   \   00007B   7003         JNZ     $+5
   \   00007D   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    302                return;   // No endpoint found
    303          
    304              epDesc = afFindEndPointDesc( grpEp );
   \   000080                ; Setup parameters for call to function afFindEndPointDesc
   \   000080   E0           MOVX    A,@DPTR
   \   000081   F9           MOV     R1,A
   \   000082   12....       LCALL   ??afFindEndPointDesc?relay
   \   000085   8A..         MOV     ?V0 + 4,R2
   \   000087   8B..         MOV     ?V0 + 5,R3
   \   000089   AE..         MOV     R6,?V0 + 4
   \   00008B   AF..         MOV     R7,?V0 + 5
    305              if ( epDesc == NULL )
   \   00008D   EE           MOV     A,R6
   \   00008E   4F           ORL     A,R7
   \   00008F   7003         JNZ     $+5
   \   000091   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    306                return;   // Endpoint descriptor not found
    307          
    308              pList = afFindEndPointDescList( epDesc->endPoint );
   \   000094                ; Setup parameters for call to function afFindEndPointDescList
   \   000094   02....       LJMP    ??afIncomingData_2 & 0xFFFF
    309          #else
    310              return; // Not supported
    311          #endif    
    312            }
    313            else if ( aff->DstEndPoint == AF_BROADCAST_ENDPOINT )
   \                     ??afIncomingData_0:
   \   000097   7401         MOV     A,#0x1
   \   000099   12....       LCALL   ?XSTACK_DISP0_8
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   2402         ADD     A,#0x2
   \   00009F   F8           MOV     R0,A
   \   0000A0   A3           INC     DPTR
   \   0000A1   E0           MOVX    A,@DPTR
   \   0000A2   3400         ADDC    A,#0x0
   \   0000A4   F9           MOV     R1,A
   \   0000A5   8882         MOV     DPL,R0
   \   0000A7   8983         MOV     DPH,R1
   \   0000A9   E0           MOVX    A,@DPTR
   \   0000AA   F4           CPL     A
   \   0000AB   701D         JNZ     ??afIncomingData_3
    314            {
    315              // Set the list
    316              if ( (pList = epList) )
   \   0000AD   90....       MOV     DPTR,#epList
   \   0000B0   E0           MOVX    A,@DPTR
   \   0000B1   F5..         MOV     ?V0 + 6,A
   \   0000B3   A3           INC     DPTR
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F5..         MOV     ?V0 + 7,A
   \   0000B7   E5..         MOV     A,?V0 + 6
   \   0000B9   45..         ORL     A,?V0 + 7
   \   0000BB   6076         JZ      ??afIncomingData_4
    317              {
    318                epDesc = pList->epDesc;
   \                     ??afIncomingData_5:
   \   0000BD   85..82       MOV     DPL,?V0 + 6
   \   0000C0   85..83       MOV     DPH,?V0 + 7
   \   0000C3   E0           MOVX    A,@DPTR
   \   0000C4   FE           MOV     R6,A
   \   0000C5   A3           INC     DPTR
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   FF           MOV     R7,A
   \   0000C8   8069         SJMP    ??afIncomingData_4
    319              }
    320            }
    321            else if ( (epDesc = afFindEndPointDesc( aff->DstEndPoint )) )
   \                     ??afIncomingData_3:
   \   0000CA                ; Setup parameters for call to function afFindEndPointDesc
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   F9           MOV     R1,A
   \   0000CC   12....       LCALL   ??afFindEndPointDesc?relay
   \   0000CF   8A..         MOV     ?V0 + 4,R2
   \   0000D1   8B..         MOV     ?V0 + 5,R3
   \   0000D3   A8..         MOV     R0,?V0 + 4
   \   0000D5   A9..         MOV     R1,?V0 + 5
   \   0000D7   E8           MOV     A,R0
   \   0000D8   FE           MOV     R6,A
   \   0000D9   E9           MOV     A,R1
   \   0000DA   FF           MOV     R7,A
   \   0000DB   E8           MOV     A,R0
   \   0000DC   49           ORL     A,R1
   \   0000DD   6054         JZ      ??afIncomingData_4
   \   0000DF   8045         SJMP    ??afIncomingData_2
    322            {
    323              pList = afFindEndPointDescList( epDesc->endPoint );
    324            }
    325          
    326            while ( epDesc )
    327            {
    328              if ( pList->pfnDescCB )
    329              {
    330                uint16 *pID = (uint16 *)(pList->pfnDescCB(
    331                                           AF_DESCRIPTOR_PROFILE_ID, epDesc->endPoint ));
    332                if ( pID )
    333                {
    334                  epProfileID = *pID;
    335                  osal_mem_free( pID );
    336                }
    337              }
    338              else if ( epDesc->simpleDesc )
    339              {
    340                epProfileID = epDesc->simpleDesc->AppProfId;
    341              }
    342          
    343              if ( (aff->ProfileID == epProfileID) ||
    344                   ((epDesc->endPoint == ZDO_EP) && (aff->ProfileID == ZDO_PROFILE_ID)) )
    345              {
    346                {
    347                  afBuildMSGIncoming( aff, epDesc, SrcAddress, SrcPanId, sig, SecurityUse, timestamp );
    348                }
    349              }
    350          
    351              if ( ((aff->FrmCtrl & APS_DELIVERYMODE_MASK) == APS_FC_DM_GROUP) )
    352              {
    353          #if !defined ( APS_NO_GROUPS )      
    354                // Find the next endpoint for this group
    355                grpEp = aps_FindGroupForEndpoint( aff->GroupID, grpEp );
   \                     ??afIncomingData_6:
   \   0000E1                ; Setup parameters for call to function aps_FindGroupForEndpoint
   \   0000E1   85..82       MOV     DPL,?XSP + 0
   \   0000E4   85..83       MOV     DPH,?XSP + 1
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   F9           MOV     R1,A
   \   0000E9   7401         MOV     A,#0x1
   \   0000EB   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EE   E0           MOVX    A,@DPTR
   \   0000EF   F8           MOV     R0,A
   \   0000F0   A3           INC     DPTR
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   F583         MOV     DPH,A
   \   0000F4   8882         MOV     DPL,R0
   \   0000F6   A3           INC     DPTR
   \   0000F7   A3           INC     DPTR
   \   0000F8   A3           INC     DPTR
   \   0000F9   A3           INC     DPTR
   \   0000FA   E0           MOVX    A,@DPTR
   \   0000FB   FA           MOV     R2,A
   \   0000FC   A3           INC     DPTR
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   FB           MOV     R3,A
   \   0000FF   12....       LCALL   ??aps_FindGroupForEndpoint?relay
   \   000102   E9           MOV     A,R1
   \   000103   85..82       MOV     DPL,?XSP + 0
   \   000106   85..83       MOV     DPH,?XSP + 1
   \   000109   F0           MOVX    @DPTR,A
    356                if ( grpEp == APS_GROUPS_EP_NOT_FOUND )
   \   00010A   E0           MOVX    A,@DPTR
   \   00010B   64FE         XRL     A,#0xfe
   \   00010D   7003         JNZ     $+5
   \   00010F   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    357                  return;   // No endpoint found
    358          
    359                epDesc = afFindEndPointDesc( grpEp );
   \   000112                ; Setup parameters for call to function afFindEndPointDesc
   \   000112   E0           MOVX    A,@DPTR
   \   000113   F9           MOV     R1,A
   \   000114   12....       LCALL   ??afFindEndPointDesc?relay
   \   000117   8A..         MOV     ?V0 + 4,R2
   \   000119   8B..         MOV     ?V0 + 5,R3
   \   00011B   AE..         MOV     R6,?V0 + 4
   \   00011D   AF..         MOV     R7,?V0 + 5
    360                if ( epDesc == NULL )
   \   00011F   EE           MOV     A,R6
   \   000120   4F           ORL     A,R7
   \   000121   7003         JNZ     $+5
   \   000123   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    361                  return;   // Endpoint descriptor not found
    362          
    363                pList = afFindEndPointDescList( epDesc->endPoint );
   \   000126                ; Setup parameters for call to function afFindEndPointDescList
   \                     ??afIncomingData_2:
   \   000126   8E82         MOV     DPL,R6
   \   000128   8F83         MOV     DPH,R7
   \   00012A   E0           MOVX    A,@DPTR
   \   00012B   F9           MOV     R1,A
   \   00012C   12....       LCALL   ??afFindEndPointDescList?relay
   \   00012F   8A..         MOV     ?V0 + 6,R2
   \   000131   8B..         MOV     ?V0 + 7,R3
    364          #else
    365                return;
    366          #endif      
    367              }
   \                     ??afIncomingData_4:
   \   000133   EE           MOV     A,R6
   \   000134   4F           ORL     A,R7
   \   000135   7003         JNZ     $+5
   \   000137   02....       LJMP    ??afIncomingData_1 & 0xFFFF
   \   00013A   E5..         MOV     A,?V0 + 6
   \   00013C   2403         ADD     A,#0x3
   \   00013E   F8           MOV     R0,A
   \   00013F   E5..         MOV     A,?V0 + 7
   \   000141   3400         ADDC    A,#0x0
   \   000143   F9           MOV     R1,A
   \   000144   E8           MOV     A,R0
   \   000145   FC           MOV     R4,A
   \   000146   E9           MOV     A,R1
   \   000147   FD           MOV     R5,A
   \   000148   8C82         MOV     DPL,R4
   \   00014A   8D83         MOV     DPH,R5
   \   00014C   E0           MOVX    A,@DPTR
   \   00014D   F8           MOV     R0,A
   \   00014E   A3           INC     DPTR
   \   00014F   E0           MOVX    A,@DPTR
   \   000150   F9           MOV     R1,A
   \   000151   E8           MOV     A,R0
   \   000152   49           ORL     A,R1
   \   000153   6033         JZ      ??afIncomingData_7
   \   000155                ; Setup parameters for indirect call
   \   000155   8E82         MOV     DPL,R6
   \   000157   8F83         MOV     DPH,R7
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   FA           MOV     R2,A
   \   00015B   7902         MOV     R1,#0x2
   \   00015D   8C82         MOV     DPL,R4
   \   00015F   8D83         MOV     DPH,R5
   \   000161   E0           MOVX    A,@DPTR
   \   000162   F8           MOV     R0,A
   \   000163   A3           INC     DPTR
   \   000164   E0           MOVX    A,@DPTR
   \   000165   F583         MOV     DPH,A
   \   000167   8882         MOV     DPL,R0
   \   000169   12....       LCALL   ?CALL_IND
   \   00016C   EA           MOV     A,R2
   \   00016D   4B           ORL     A,R3
   \   00016E   6049         JZ      ??afIncomingData_8
   \   000170   8A82         MOV     DPL,R2
   \   000172   8B83         MOV     DPH,R3
   \   000174   E0           MOVX    A,@DPTR
   \   000175   F8           MOV     R0,A
   \   000176   A3           INC     DPTR
   \   000177   E0           MOVX    A,@DPTR
   \   000178   F9           MOV     R1,A
   \   000179   7403         MOV     A,#0x3
   \   00017B   12....       LCALL   ?XSTACK_DISP0_8
   \   00017E   E8           MOV     A,R0
   \   00017F   F0           MOVX    @DPTR,A
   \   000180   A3           INC     DPTR
   \   000181   E9           MOV     A,R1
   \   000182   F0           MOVX    @DPTR,A
   \   000183                ; Setup parameters for call to function osal_mem_free
   \   000183   12....       LCALL   ??osal_mem_free?relay
   \   000186   8031         SJMP    ??afIncomingData_8
   \                     ??afIncomingData_7:
   \   000188   EE           MOV     A,R6
   \   000189   2403         ADD     A,#0x3
   \   00018B   F8           MOV     R0,A
   \   00018C   EF           MOV     A,R7
   \   00018D   3400         ADDC    A,#0x0
   \   00018F   F9           MOV     R1,A
   \   000190   8882         MOV     DPL,R0
   \   000192   8983         MOV     DPH,R1
   \   000194   E0           MOVX    A,@DPTR
   \   000195   FA           MOV     R2,A
   \   000196   A3           INC     DPTR
   \   000197   E0           MOVX    A,@DPTR
   \   000198   FB           MOV     R3,A
   \   000199   EA           MOV     A,R2
   \   00019A   4B           ORL     A,R3
   \   00019B   601C         JZ      ??afIncomingData_8
   \   00019D   8882         MOV     DPL,R0
   \   00019F   8983         MOV     DPH,R1
   \   0001A1   E0           MOVX    A,@DPTR
   \   0001A2   F8           MOV     R0,A
   \   0001A3   A3           INC     DPTR
   \   0001A4   E0           MOVX    A,@DPTR
   \   0001A5   F583         MOV     DPH,A
   \   0001A7   8882         MOV     DPL,R0
   \   0001A9   A3           INC     DPTR
   \   0001AA   E0           MOVX    A,@DPTR
   \   0001AB   F8           MOV     R0,A
   \   0001AC   A3           INC     DPTR
   \   0001AD   E0           MOVX    A,@DPTR
   \   0001AE   F9           MOV     R1,A
   \   0001AF   7403         MOV     A,#0x3
   \   0001B1   12....       LCALL   ?XSTACK_DISP0_8
   \   0001B4   E8           MOV     A,R0
   \   0001B5   F0           MOVX    @DPTR,A
   \   0001B6   A3           INC     DPTR
   \   0001B7   E9           MOV     A,R1
   \   0001B8   F0           MOVX    @DPTR,A
   \                     ??afIncomingData_8:
   \   0001B9   7401         MOV     A,#0x1
   \   0001BB   12....       LCALL   ?XSTACK_DISP0_8
   \   0001BE   E0           MOVX    A,@DPTR
   \   0001BF   2408         ADD     A,#0x8
   \   0001C1   F8           MOV     R0,A
   \   0001C2   A3           INC     DPTR
   \   0001C3   E0           MOVX    A,@DPTR
   \   0001C4   3400         ADDC    A,#0x0
   \   0001C6   F9           MOV     R1,A
   \   0001C7   8882         MOV     DPL,R0
   \   0001C9   8983         MOV     DPH,R1
   \   0001CB   E0           MOVX    A,@DPTR
   \   0001CC   FA           MOV     R2,A
   \   0001CD   A3           INC     DPTR
   \   0001CE   E0           MOVX    A,@DPTR
   \   0001CF   FB           MOV     R3,A
   \   0001D0   7403         MOV     A,#0x3
   \   0001D2   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D5   E0           MOVX    A,@DPTR
   \   0001D6   6A           XRL     A,R2
   \   0001D7   7003         JNZ     ??afIncomingData_9
   \   0001D9   A3           INC     DPTR
   \   0001DA   E0           MOVX    A,@DPTR
   \   0001DB   6B           XRL     A,R3
   \                     ??afIncomingData_9:
   \   0001DC   6014         JZ      ??afIncomingData_10
   \   0001DE   8E82         MOV     DPL,R6
   \   0001E0   8F83         MOV     DPH,R7
   \   0001E2   E0           MOVX    A,@DPTR
   \   0001E3   7047         JNZ     ??afIncomingData_11
   \   0001E5   8882         MOV     DPL,R0
   \   0001E7   8983         MOV     DPH,R1
   \   0001E9   E0           MOVX    A,@DPTR
   \   0001EA   F8           MOV     R0,A
   \   0001EB   A3           INC     DPTR
   \   0001EC   E0           MOVX    A,@DPTR
   \   0001ED   F9           MOV     R1,A
   \   0001EE   E8           MOV     A,R0
   \   0001EF   49           ORL     A,R1
   \   0001F0   703A         JNZ     ??afIncomingData_11
   \                     ??afIncomingData_10:
   \   0001F2                ; Setup parameters for call to function afBuildMSGIncoming
   \   0001F2   78..         MOV     R0,#?V0 + 0
   \   0001F4   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   0001F7   741E         MOV     A,#0x1e
   \   0001F9   12....       LCALL   ?XSTACK_DISP0_8
   \   0001FC   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   0001FF   741E         MOV     A,#0x1e
   \   000201   12....       LCALL   ?XSTACK_DISP0_8
   \   000204   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000207   740E         MOV     A,#0xe
   \   000209   12....       LCALL   ?XSTACK_DISP0_8
   \   00020C   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00020F   740F         MOV     A,#0xf
   \   000211   12....       LCALL   ?XSTACK_DISP0_8
   \   000214   E0           MOVX    A,@DPTR
   \   000215   F9           MOV     R1,A
   \   000216   EE           MOV     A,R6
   \   000217   FC           MOV     R4,A
   \   000218   EF           MOV     A,R7
   \   000219   FD           MOV     R5,A
   \   00021A   740B         MOV     A,#0xb
   \   00021C   12....       LCALL   ?XSTACK_DISP0_8
   \   00021F   E0           MOVX    A,@DPTR
   \   000220   FA           MOV     R2,A
   \   000221   A3           INC     DPTR
   \   000222   E0           MOVX    A,@DPTR
   \   000223   FB           MOV     R3,A
   \   000224   12....       LCALL   ??afBuildMSGIncoming?relay
   \   000227   740A         MOV     A,#0xa
   \   000229   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??afIncomingData_11:
   \   00022C   7401         MOV     A,#0x1
   \   00022E   12....       LCALL   ?XSTACK_DISP0_8
   \   000231   E0           MOVX    A,@DPTR
   \   000232   F8           MOV     R0,A
   \   000233   A3           INC     DPTR
   \   000234   E0           MOVX    A,@DPTR
   \   000235   F583         MOV     DPH,A
   \   000237   8882         MOV     DPL,R0
   \   000239   E0           MOVX    A,@DPTR
   \   00023A   540C         ANL     A,#0xc
   \   00023C   640C         XRL     A,#0xc
   \   00023E   7003         JNZ     $+5
   \   000240   02....       LJMP    ??afIncomingData_6 & 0xFFFF
    368              else if ( aff->DstEndPoint == AF_BROADCAST_ENDPOINT )
   \   000243   7401         MOV     A,#0x1
   \   000245   12....       LCALL   ?XSTACK_DISP0_8
   \   000248   E0           MOVX    A,@DPTR
   \   000249   F8           MOV     R0,A
   \   00024A   A3           INC     DPTR
   \   00024B   E0           MOVX    A,@DPTR
   \   00024C   F583         MOV     DPH,A
   \   00024E   8882         MOV     DPL,R0
   \   000250   A3           INC     DPTR
   \   000251   A3           INC     DPTR
   \   000252   E0           MOVX    A,@DPTR
   \   000253   F4           CPL     A
   \   000254   701B         JNZ     ??afIncomingData_12
    369              {
    370                pList = pList->nextDesc;
   \   000256   85..82       MOV     DPL,?V0 + 6
   \   000259   85..83       MOV     DPH,?V0 + 7
   \   00025C   A3           INC     DPTR
   \   00025D   A3           INC     DPTR
   \   00025E   A3           INC     DPTR
   \   00025F   A3           INC     DPTR
   \   000260   A3           INC     DPTR
   \   000261   E0           MOVX    A,@DPTR
   \   000262   F5..         MOV     ?V0 + 6,A
   \   000264   A3           INC     DPTR
   \   000265   E0           MOVX    A,@DPTR
   \   000266   F5..         MOV     ?V0 + 7,A
    371                if ( pList )
   \   000268   E5..         MOV     A,?V0 + 6
   \   00026A   45..         ORL     A,?V0 + 7
   \   00026C   6003         JZ      $+5
   \   00026E   02....       LJMP    ??afIncomingData_5 & 0xFFFF
    372                  epDesc = pList->epDesc;
    373                else
    374                  epDesc = NULL;
   \                     ??afIncomingData_12:
   \   000271   7E00         MOV     R6,#0x0
   \   000273   7F00         MOV     R7,#0x0
   \   000275   02....       LJMP    ??afIncomingData_4 & 0xFFFF
    375              }
    376              else
    377                epDesc = NULL;
    378            }
   \                     ??afIncomingData_1:
   \   000278   7408         MOV     A,#0x8
   \   00027A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00027D   7F08         MOV     R7,#0x8
   \   00027F   02....       LJMP    ?BANKED_LEAVE_XDATA
    379          }
    380          
    381          /*********************************************************************
    382           * @fn          afBuildMSGIncoming
    383           *
    384           * @brief       Build the message for the app
    385           *
    386           * @param
    387           *
    388           * @return      pointer to next in data buffer
    389           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    390          static void afBuildMSGIncoming( aps_FrameFormat_t *aff, endPointDesc_t *epDesc,
   \                     afBuildMSGIncoming:
    391                           zAddrType_t *SrcAddress, uint16 SrcPanId, NLDE_Signal_t *sig, 
    392                           byte SecurityUse, uint32 timestamp )
    393          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7401         MOV     A,#0x1
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   EC           MOV     A,R4
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   ED           MOV     A,R5
   \   000013   F0           MOVX    @DPTR,A
   \   000014   E9           MOV     A,R1
   \   000015   85..82       MOV     DPL,?XSP + 0
   \   000018   85..83       MOV     DPH,?XSP + 1
   \   00001B   F0           MOVX    @DPTR,A
   \   00001C   8A..         MOV     ?V0 + 0,R2
   \   00001E   8B..         MOV     ?V0 + 1,R3
    394            afIncomingMSGPacket_t *MSGpkt;
    395            const byte len = sizeof( afIncomingMSGPacket_t ) + aff->asduLength;
    396            byte *asdu = aff->asdu;
   \   000020   EA           MOV     A,R2
   \   000021   240E         ADD     A,#0xe
   \   000023   F582         MOV     DPL,A
   \   000025   EB           MOV     A,R3
   \   000026   3400         ADDC    A,#0x0
   \   000028   F583         MOV     DPH,A
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F5..         MOV     ?V0 + 6,A
   \   00002D   A3           INC     DPTR
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   F5..         MOV     ?V0 + 7,A
    397            MSGpkt = (afIncomingMSGPacket_t *)osal_msg_allocate( len );
   \   000031   EA           MOV     A,R2
   \   000032   2410         ADD     A,#0x10
   \   000034   F5..         MOV     ?V0 + 2,A
   \   000036   EB           MOV     A,R3
   \   000037   3400         ADDC    A,#0x0
   \   000039   F5..         MOV     ?V0 + 3,A
   \   00003B                ; Setup parameters for call to function osal_msg_allocate
   \   00003B   85..82       MOV     DPL,?V0 + 2
   \   00003E   F583         MOV     DPH,A
   \   000040   E0           MOVX    A,@DPTR
   \   000041   2423         ADD     A,#0x23
   \   000043   FA           MOV     R2,A
   \   000044   7B00         MOV     R3,#0x0
   \   000046   12....       LCALL   ??osal_msg_allocate?relay
   \   000049   8A..         MOV     ?V0 + 4,R2
   \   00004B   8B..         MOV     ?V0 + 5,R3
   \   00004D   AE..         MOV     R6,?V0 + 4
   \   00004F   AF..         MOV     R7,?V0 + 5
    398          
    399            if ( MSGpkt == NULL )
   \   000051   EE           MOV     A,R6
   \   000052   4F           ORL     A,R7
   \   000053   7003         JNZ     $+5
   \   000055   02....       LJMP    ??afBuildMSGIncoming_0 & 0xFFFF
    400            {
    401              return;
    402            }
    403          
    404            MSGpkt->hdr.event = AF_INCOMING_MSG_CMD;
   \   000058   8E82         MOV     DPL,R6
   \   00005A   8F83         MOV     DPH,R7
   \   00005C   741A         MOV     A,#0x1a
   \   00005E   F0           MOVX    @DPTR,A
    405            MSGpkt->groupId = aff->GroupID;
   \   00005F   85..82       MOV     DPL,?V0 + 0
   \   000062   85..83       MOV     DPH,?V0 + 1
   \   000065   A3           INC     DPTR
   \   000066   A3           INC     DPTR
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F8           MOV     R0,A
   \   00006B   A3           INC     DPTR
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F9           MOV     R1,A
   \   00006E   8E82         MOV     DPL,R6
   \   000070   8F83         MOV     DPH,R7
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   E8           MOV     A,R0
   \   000075   F0           MOVX    @DPTR,A
   \   000076   A3           INC     DPTR
   \   000077   E9           MOV     A,R1
   \   000078   F0           MOVX    @DPTR,A
    406            MSGpkt->clusterId = aff->ClusterID;
   \   000079   85..82       MOV     DPL,?V0 + 0
   \   00007C   85..83       MOV     DPH,?V0 + 1
   \   00007F   A3           INC     DPTR
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   A3           INC     DPTR
   \   000084   A3           INC     DPTR
   \   000085   E0           MOVX    A,@DPTR
   \   000086   F8           MOV     R0,A
   \   000087   A3           INC     DPTR
   \   000088   E0           MOVX    A,@DPTR
   \   000089   F9           MOV     R1,A
   \   00008A   8E82         MOV     DPL,R6
   \   00008C   8F83         MOV     DPH,R7
   \   00008E   A3           INC     DPTR
   \   00008F   A3           INC     DPTR
   \   000090   A3           INC     DPTR
   \   000091   A3           INC     DPTR
   \   000092   E8           MOV     A,R0
   \   000093   F0           MOVX    @DPTR,A
   \   000094   A3           INC     DPTR
   \   000095   E9           MOV     A,R1
   \   000096   F0           MOVX    @DPTR,A
    407            afCopyAddress( &MSGpkt->srcAddr, SrcAddress );
   \   000097                ; Setup parameters for call to function afCopyAddress
   \   000097   7413         MOV     A,#0x13
   \   000099   12....       LCALL   ?XSTACK_DISP0_8
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   FC           MOV     R4,A
   \   00009E   A3           INC     DPTR
   \   00009F   E0           MOVX    A,@DPTR
   \   0000A0   FD           MOV     R5,A
   \   0000A1   EE           MOV     A,R6
   \   0000A2   2406         ADD     A,#0x6
   \   0000A4   FA           MOV     R2,A
   \   0000A5   EF           MOV     A,R7
   \   0000A6   3400         ADDC    A,#0x0
   \   0000A8   FB           MOV     R3,A
   \   0000A9   12....       LCALL   ??afCopyAddress?relay
    408            MSGpkt->srcAddr.endPoint = aff->SrcEndPoint;
   \   0000AC   85..82       MOV     DPL,?V0 + 0
   \   0000AF   85..83       MOV     DPH,?V0 + 1
   \   0000B2   A3           INC     DPTR
   \   0000B3   A3           INC     DPTR
   \   0000B4   A3           INC     DPTR
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   C0E0         PUSH    A
   \   0000B8   EE           MOV     A,R6
   \   0000B9   240F         ADD     A,#0xf
   \   0000BB   F582         MOV     DPL,A
   \   0000BD   EF           MOV     A,R7
   \   0000BE   3400         ADDC    A,#0x0
   \   0000C0   F583         MOV     DPH,A
   \   0000C2   D0E0         POP     A
   \   0000C4   F0           MOVX    @DPTR,A
    409            MSGpkt->endPoint = epDesc->endPoint;
   \   0000C5   7401         MOV     A,#0x1
   \   0000C7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   F8           MOV     R0,A
   \   0000CC   A3           INC     DPTR
   \   0000CD   E0           MOVX    A,@DPTR
   \   0000CE   F583         MOV     DPH,A
   \   0000D0   8882         MOV     DPL,R0
   \   0000D2   E0           MOVX    A,@DPTR
   \   0000D3   C0E0         PUSH    A
   \   0000D5   EE           MOV     A,R6
   \   0000D6   2414         ADD     A,#0x14
   \   0000D8   F582         MOV     DPL,A
   \   0000DA   EF           MOV     A,R7
   \   0000DB   3400         ADDC    A,#0x0
   \   0000DD   F583         MOV     DPH,A
   \   0000DF   D0E0         POP     A
   \   0000E1   F0           MOVX    @DPTR,A
    410            MSGpkt->wasBroadcast = aff->wasBroadcast;
   \   0000E2   E5..         MOV     A,?V0 + 0
   \   0000E4   240C         ADD     A,#0xc
   \   0000E6   F582         MOV     DPL,A
   \   0000E8   E5..         MOV     A,?V0 + 1
   \   0000EA   3400         ADDC    A,#0x0
   \   0000EC   F583         MOV     DPH,A
   \   0000EE   E0           MOVX    A,@DPTR
   \   0000EF   C0E0         PUSH    A
   \   0000F1   EE           MOV     A,R6
   \   0000F2   2415         ADD     A,#0x15
   \   0000F4   F582         MOV     DPL,A
   \   0000F6   EF           MOV     A,R7
   \   0000F7   3400         ADDC    A,#0x0
   \   0000F9   F583         MOV     DPH,A
   \   0000FB   D0E0         POP     A
   \   0000FD   F0           MOVX    @DPTR,A
    411            MSGpkt->LinkQuality = sig->LinkQuality;
   \   0000FE   7417         MOV     A,#0x17
   \   000100   12....       LCALL   ?XSTACK_DISP0_8
   \   000103   E0           MOVX    A,@DPTR
   \   000104   F8           MOV     R0,A
   \   000105   A3           INC     DPTR
   \   000106   E0           MOVX    A,@DPTR
   \   000107   F583         MOV     DPH,A
   \   000109   8882         MOV     DPL,R0
   \   00010B   E0           MOVX    A,@DPTR
   \   00010C   C0E0         PUSH    A
   \   00010E   EE           MOV     A,R6
   \   00010F   2416         ADD     A,#0x16
   \   000111   F582         MOV     DPL,A
   \   000113   EF           MOV     A,R7
   \   000114   3400         ADDC    A,#0x0
   \   000116   F583         MOV     DPH,A
   \   000118   D0E0         POP     A
   \   00011A   F0           MOVX    @DPTR,A
    412            MSGpkt->correlation = sig->correlation;
   \   00011B   7417         MOV     A,#0x17
   \   00011D   12....       LCALL   ?XSTACK_DISP0_8
   \   000120   E0           MOVX    A,@DPTR
   \   000121   F8           MOV     R0,A
   \   000122   A3           INC     DPTR
   \   000123   E0           MOVX    A,@DPTR
   \   000124   F583         MOV     DPH,A
   \   000126   8882         MOV     DPL,R0
   \   000128   A3           INC     DPTR
   \   000129   E0           MOVX    A,@DPTR
   \   00012A   C0E0         PUSH    A
   \   00012C   EE           MOV     A,R6
   \   00012D   2417         ADD     A,#0x17
   \   00012F   F582         MOV     DPL,A
   \   000131   EF           MOV     A,R7
   \   000132   3400         ADDC    A,#0x0
   \   000134   F583         MOV     DPH,A
   \   000136   D0E0         POP     A
   \   000138   F0           MOVX    @DPTR,A
    413            MSGpkt->rssi = sig->rssi;
   \   000139   7417         MOV     A,#0x17
   \   00013B   12....       LCALL   ?XSTACK_DISP0_8
   \   00013E   E0           MOVX    A,@DPTR
   \   00013F   F8           MOV     R0,A
   \   000140   A3           INC     DPTR
   \   000141   E0           MOVX    A,@DPTR
   \   000142   F583         MOV     DPH,A
   \   000144   8882         MOV     DPL,R0
   \   000146   A3           INC     DPTR
   \   000147   A3           INC     DPTR
   \   000148   E0           MOVX    A,@DPTR
   \   000149   C0E0         PUSH    A
   \   00014B   EE           MOV     A,R6
   \   00014C   2418         ADD     A,#0x18
   \   00014E   F582         MOV     DPL,A
   \   000150   EF           MOV     A,R7
   \   000151   3400         ADDC    A,#0x0
   \   000153   F583         MOV     DPH,A
   \   000155   D0E0         POP     A
   \   000157   F0           MOVX    @DPTR,A
    414            MSGpkt->SecurityUse = SecurityUse;
   \   000158   85..82       MOV     DPL,?XSP + 0
   \   00015B   85..83       MOV     DPH,?XSP + 1
   \   00015E   E0           MOVX    A,@DPTR
   \   00015F   C0E0         PUSH    A
   \   000161   EE           MOV     A,R6
   \   000162   2419         ADD     A,#0x19
   \   000164   F582         MOV     DPL,A
   \   000166   EF           MOV     A,R7
   \   000167   3400         ADDC    A,#0x0
   \   000169   F583         MOV     DPH,A
   \   00016B   D0E0         POP     A
   \   00016D   F0           MOVX    @DPTR,A
    415            MSGpkt->timestamp = timestamp;
   \   00016E   7419         MOV     A,#0x19
   \   000170   12....       LCALL   ?XSTACK_DISP0_8
   \   000173   12....       LCALL   ?XLOAD_R2345
   \   000176   EE           MOV     A,R6
   \   000177   241A         ADD     A,#0x1a
   \   000179   F582         MOV     DPL,A
   \   00017B   EF           MOV     A,R7
   \   00017C   3400         ADDC    A,#0x0
   \   00017E   F583         MOV     DPH,A
   \   000180   12....       LCALL   ?XSTORE_R2345
    416            MSGpkt->macDestAddr = aff->macDestAddr;
   \   000183   85..82       MOV     DPL,?V0 + 0
   \   000186   85..83       MOV     DPH,?V0 + 1
   \   000189   A3           INC     DPTR
   \   00018A   A3           INC     DPTR
   \   00018B   A3           INC     DPTR
   \   00018C   A3           INC     DPTR
   \   00018D   A3           INC     DPTR
   \   00018E   A3           INC     DPTR
   \   00018F   A3           INC     DPTR
   \   000190   A3           INC     DPTR
   \   000191   A3           INC     DPTR
   \   000192   A3           INC     DPTR
   \   000193   E0           MOVX    A,@DPTR
   \   000194   F8           MOV     R0,A
   \   000195   A3           INC     DPTR
   \   000196   E0           MOVX    A,@DPTR
   \   000197   F9           MOV     R1,A
   \   000198   EE           MOV     A,R6
   \   000199   2412         ADD     A,#0x12
   \   00019B   F582         MOV     DPL,A
   \   00019D   EF           MOV     A,R7
   \   00019E   3400         ADDC    A,#0x0
   \   0001A0   F583         MOV     DPH,A
   \   0001A2   E8           MOV     A,R0
   \   0001A3   F0           MOVX    @DPTR,A
   \   0001A4   A3           INC     DPTR
   \   0001A5   E9           MOV     A,R1
   \   0001A6   F0           MOVX    @DPTR,A
    417            MSGpkt->srcAddr.panId = SrcPanId;
   \   0001A7   7415         MOV     A,#0x15
   \   0001A9   12....       LCALL   ?XSTACK_DISP0_8
   \   0001AC   E0           MOVX    A,@DPTR
   \   0001AD   F8           MOV     R0,A
   \   0001AE   A3           INC     DPTR
   \   0001AF   E0           MOVX    A,@DPTR
   \   0001B0   F9           MOV     R1,A
   \   0001B1   EE           MOV     A,R6
   \   0001B2   2410         ADD     A,#0x10
   \   0001B4   F582         MOV     DPL,A
   \   0001B6   EF           MOV     A,R7
   \   0001B7   3400         ADDC    A,#0x0
   \   0001B9   F583         MOV     DPH,A
   \   0001BB   E8           MOV     A,R0
   \   0001BC   F0           MOVX    @DPTR,A
   \   0001BD   A3           INC     DPTR
   \   0001BE   E9           MOV     A,R1
   \   0001BF   F0           MOVX    @DPTR,A
    418            MSGpkt->cmd.TransSeqNumber = 0;
   \   0001C0   EE           MOV     A,R6
   \   0001C1   241E         ADD     A,#0x1e
   \   0001C3   F582         MOV     DPL,A
   \   0001C5   EF           MOV     A,R7
   \   0001C6   3400         ADDC    A,#0x0
   \   0001C8   F583         MOV     DPH,A
   \   0001CA   E4           CLR     A
   \   0001CB   F0           MOVX    @DPTR,A
    419            MSGpkt->cmd.DataLength = aff->asduLength;
   \   0001CC   EE           MOV     A,R6
   \   0001CD   241F         ADD     A,#0x1f
   \   0001CF   FA           MOV     R2,A
   \   0001D0   EF           MOV     A,R7
   \   0001D1   3400         ADDC    A,#0x0
   \   0001D3   FB           MOV     R3,A
   \   0001D4   85..82       MOV     DPL,?V0 + 2
   \   0001D7   85..83       MOV     DPH,?V0 + 3
   \   0001DA   E0           MOVX    A,@DPTR
   \   0001DB   8A82         MOV     DPL,R2
   \   0001DD   8B83         MOV     DPH,R3
   \   0001DF   F0           MOVX    @DPTR,A
   \   0001E0   A3           INC     DPTR
   \   0001E1   E4           CLR     A
   \   0001E2   F0           MOVX    @DPTR,A
    420          
    421            if ( MSGpkt->cmd.DataLength )
   \   0001E3   EE           MOV     A,R6
   \   0001E4   2421         ADD     A,#0x21
   \   0001E6   F5..         MOV     ?V0 + 4,A
   \   0001E8   EF           MOV     A,R7
   \   0001E9   3400         ADDC    A,#0x0
   \   0001EB   F5..         MOV     ?V0 + 5,A
   \   0001ED   8A82         MOV     DPL,R2
   \   0001EF   8B83         MOV     DPH,R3
   \   0001F1   E0           MOVX    A,@DPTR
   \   0001F2   F8           MOV     R0,A
   \   0001F3   A3           INC     DPTR
   \   0001F4   E0           MOVX    A,@DPTR
   \   0001F5   F9           MOV     R1,A
   \   0001F6   E8           MOV     A,R0
   \   0001F7   49           ORL     A,R1
   \   0001F8   603F         JZ      ??afBuildMSGIncoming_1
    422            {
    423              MSGpkt->cmd.Data = (byte *)(MSGpkt + 1);
   \   0001FA   EE           MOV     A,R6
   \   0001FB   2423         ADD     A,#0x23
   \   0001FD   F8           MOV     R0,A
   \   0001FE   EF           MOV     A,R7
   \   0001FF   3400         ADDC    A,#0x0
   \   000201   F9           MOV     R1,A
   \   000202   85..82       MOV     DPL,?V0 + 4
   \   000205   85..83       MOV     DPH,?V0 + 5
   \   000208   E8           MOV     A,R0
   \   000209   F0           MOVX    @DPTR,A
   \   00020A   A3           INC     DPTR
   \   00020B   E9           MOV     A,R1
   \   00020C   F0           MOVX    @DPTR,A
    424              osal_memcpy( MSGpkt->cmd.Data, asdu, MSGpkt->cmd.DataLength );
   \   00020D                ; Setup parameters for call to function osal_memcpy
   \   00020D   85....       MOV     ?V0 + 0,?V0 + 6
   \   000210   85....       MOV     ?V0 + 1,?V0 + 7
   \   000213   75..00       MOV     ?V0 + 2,#0x0
   \   000216   78..         MOV     R0,#?V0 + 0
   \   000218   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00021B   8A82         MOV     DPL,R2
   \   00021D   8B83         MOV     DPH,R3
   \   00021F   E0           MOVX    A,@DPTR
   \   000220   FC           MOV     R4,A
   \   000221   A3           INC     DPTR
   \   000222   E0           MOVX    A,@DPTR
   \   000223   FD           MOV     R5,A
   \   000224   85..82       MOV     DPL,?V0 + 4
   \   000227   85..83       MOV     DPH,?V0 + 5
   \   00022A   E0           MOVX    A,@DPTR
   \   00022B   FA           MOV     R2,A
   \   00022C   A3           INC     DPTR
   \   00022D   E0           MOVX    A,@DPTR
   \   00022E   FB           MOV     R3,A
   \   00022F   12....       LCALL   ??osal_memcpy?relay
   \   000232   7403         MOV     A,#0x3
   \   000234   12....       LCALL   ?DEALLOC_XSTACK8
   \   000237   800A         SJMP    ??afBuildMSGIncoming_2
    425            }
    426            else
    427            {
    428              MSGpkt->cmd.Data = NULL;
   \                     ??afBuildMSGIncoming_1:
   \   000239   85..82       MOV     DPL,?V0 + 4
   \   00023C   85..83       MOV     DPH,?V0 + 5
   \   00023F   E4           CLR     A
   \   000240   F0           MOVX    @DPTR,A
   \   000241   A3           INC     DPTR
   \   000242   F0           MOVX    @DPTR,A
    429            }
    430          
    431          #if defined ( MT_AF_CB_FUNC )
    432            // If ZDO or SAPI have registered for this endpoint, dont intercept it here
    433            if (AFCB_CHECK(CB_ID_AF_DATA_IND, *(epDesc->task_id)))
    434            {
    435              MT_AfIncomingMsg( (void *)MSGpkt );
    436              // Release the memory.
    437              osal_msg_deallocate( (void *)MSGpkt );
    438            }
    439            else
    440          #endif
    441            {
    442              // Send message through task message.
    443              osal_msg_send( *(epDesc->task_id), (uint8 *)MSGpkt );
   \                     ??afBuildMSGIncoming_2:
   \   000243                ; Setup parameters for call to function osal_msg_send
   \   000243   EE           MOV     A,R6
   \   000244   FA           MOV     R2,A
   \   000245   EF           MOV     A,R7
   \   000246   FB           MOV     R3,A
   \   000247   7401         MOV     A,#0x1
   \   000249   12....       LCALL   ?XSTACK_DISP0_8
   \   00024C   E0           MOVX    A,@DPTR
   \   00024D   F8           MOV     R0,A
   \   00024E   A3           INC     DPTR
   \   00024F   E0           MOVX    A,@DPTR
   \   000250   F583         MOV     DPH,A
   \   000252   8882         MOV     DPL,R0
   \   000254   A3           INC     DPTR
   \   000255   E0           MOVX    A,@DPTR
   \   000256   F8           MOV     R0,A
   \   000257   A3           INC     DPTR
   \   000258   E0           MOVX    A,@DPTR
   \   000259   F583         MOV     DPH,A
   \   00025B   8882         MOV     DPL,R0
   \   00025D   E0           MOVX    A,@DPTR
   \   00025E   F9           MOV     R1,A
   \   00025F   12....       LCALL   ??osal_msg_send?relay
    444            }
    445          }
   \                     ??afBuildMSGIncoming_0:
   \   000262   7403         MOV     A,#0x3
   \   000264   12....       LCALL   ?DEALLOC_XSTACK8
   \   000267   7F08         MOV     R7,#0x8
   \   000269   02....       LJMP    ?BANKED_LEAVE_XDATA
    446          
    447          /*********************************************************************
    448           * @fn      AF_DataRequest
    449           *
    450           * @brief   Common functionality for invoking APSDE_DataReq() for both
    451           *          SendMulti and MSG-Send.
    452           *
    453           * input parameters
    454           *
    455           * @param  *dstAddr - Full ZB destination address: Nwk Addr + End Point.
    456           * @param  *srcEP - Origination (i.e. respond to or ack to) End Point Descr.
    457           * @param   cID - A valid cluster ID as specified by the Profile.
    458           * @param   len - Number of bytes of data pointed to by next param.
    459           * @param  *buf - A pointer to the data bytes to send.
    460           * @param  *transID - A pointer to a byte which can be modified and which will
    461           *                    be used as the transaction sequence number of the msg.
    462           * @param   options - Valid bit mask of Tx options.
    463           * @param   radius - Normally set to AF_DEFAULT_RADIUS.
    464           *
    465           * output parameters
    466           *
    467           * @param  *transID - Incremented by one if the return value is success.
    468           *
    469           * @return  afStatus_t - See previous definition of afStatus_... types.
    470           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    471          uint8 AF_DataRequestDiscoverRoute = TRUE;
   \                     AF_DataRequestDiscoverRoute:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for AF_DataRequestDiscoverRoute>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    472          afStatus_t AF_DataRequest( afAddrType_t *dstAddr, endPointDesc_t *srcEP,
   \                     AF_DataRequest:
    473                                     uint16 cID, uint16 len, uint8 *buf, uint8 *transID,
    474                                     uint8 options, uint8 radius )
    475          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 30
   \   000005   74E2         MOV     A,#-0x1e
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 2,R2
   \   00000C   8B..         MOV     ?V0 + 3,R3
   \   00000E   8C..         MOV     ?V0 + 0,R4
   \   000010   8D..         MOV     ?V0 + 1,R5
   \   000012   89..         MOV     ?V0 + 4,R1
   \   000014   7436         MOV     A,#0x36
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   F5..         MOV     ?V0 + 5,A
    476            pDescCB pfnDescCB;
    477            ZStatus_t stat;
    478            APSDE_DataReq_t req;
    479            afDataReqMTU_t mtu;
    480          
    481            // Verify source end point
    482            if ( srcEP == NULL )
   \   00001C   EC           MOV     A,R4
   \   00001D   45..         ORL     A,?V0 + 1
   \   00001F   7005         JNZ     ??AF_DataRequest_0
    483            {
    484              return afStatus_INVALID_PARAMETER;
   \                     ??AF_DataRequest_1:
   \   000021   7902         MOV     R1,#0x2
   \   000023   02....       LJMP    ??AF_DataRequest_2 & 0xFFFF
    485            }
    486          
    487          #if !defined( REFLECTOR )
    488            if ( dstAddr->addrMode == afAddrNotPresent )
    489            {
    490              return afStatus_INVALID_PARAMETER;
    491            }
    492          #endif
    493          
    494            // Validate broadcasting
    495            if ( ( dstAddr->addrMode == afAddr16Bit     ) ||
    496                 ( dstAddr->addrMode == afAddrBroadcast )    )
   \                     ??AF_DataRequest_0:
   \   000026   EA           MOV     A,R2
   \   000027   2408         ADD     A,#0x8
   \   000029   FE           MOV     R6,A
   \   00002A   EB           MOV     A,R3
   \   00002B   3400         ADDC    A,#0x0
   \   00002D   FF           MOV     R7,A
   \   00002E   8E82         MOV     DPL,R6
   \   000030   8F83         MOV     DPH,R7
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6402         XRL     A,#0x2
   \   000035   6005         JZ      ??AF_DataRequest_3
   \   000037   E0           MOVX    A,@DPTR
   \   000038   640F         XRL     A,#0xf
   \   00003A   701F         JNZ     ??AF_DataRequest_4
    497            {
    498              // Check for valid broadcast values
    499              if( ADDR_NOT_BCAST != NLME_IsAddressBroadcast( dstAddr->addr.shortAddr )  )
   \                     ??AF_DataRequest_3:
   \   00003C                ; Setup parameters for call to function NLME_IsAddressBroadcast
   \   00003C   8A82         MOV     DPL,R2
   \   00003E   8B83         MOV     DPH,R3
   \   000040   E0           MOVX    A,@DPTR
   \   000041   FA           MOV     R2,A
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   FB           MOV     R3,A
   \   000045   12....       LCALL   ??NLME_IsAddressBroadcast?relay
   \   000048   E9           MOV     A,R1
   \   000049   8E82         MOV     DPL,R6
   \   00004B   8F83         MOV     DPH,R7
   \   00004D   6005         JZ      ??AF_DataRequest_5
    500              {
    501                // Force mode to broadcast
    502                dstAddr->addrMode = afAddrBroadcast;
   \   00004F   740F         MOV     A,#0xf
   \   000051   F0           MOVX    @DPTR,A
   \   000052   8014         SJMP    ??AF_DataRequest_6
    503              }
    504              else
    505              {
    506                // Address is not a valid broadcast type
    507                if ( dstAddr->addrMode == afAddrBroadcast )
   \                     ??AF_DataRequest_5:
   \   000054   E0           MOVX    A,@DPTR
   \   000055   640F         XRL     A,#0xf
   \   000057   700F         JNZ     ??AF_DataRequest_6
   \   000059   80C6         SJMP    ??AF_DataRequest_1
    508                {
    509                  return afStatus_INVALID_PARAMETER;
    510                }
    511              }
    512            }
    513            else if ( dstAddr->addrMode != afAddr64Bit &&
    514                      dstAddr->addrMode != afAddrGroup &&
    515                      dstAddr->addrMode != afAddrNotPresent )
   \                     ??AF_DataRequest_4:
   \   00005B   E0           MOVX    A,@DPTR
   \   00005C   6403         XRL     A,#0x3
   \   00005E   6008         JZ      ??AF_DataRequest_6
   \   000060   E0           MOVX    A,@DPTR
   \   000061   6401         XRL     A,#0x1
   \   000063   6003         JZ      ??AF_DataRequest_6
   \   000065   E0           MOVX    A,@DPTR
   \   000066   70B9         JNZ     ??AF_DataRequest_1
    516            {
    517              return afStatus_INVALID_PARAMETER;
    518            }
    519            
    520            // Set destination address
    521            req.dstAddr.addrMode = dstAddr->addrMode;
   \                     ??AF_DataRequest_6:
   \   000068   E0           MOVX    A,@DPTR
   \   000069   C0E0         PUSH    A
   \   00006B   740A         MOV     A,#0xa
   \   00006D   12....       LCALL   ?XSTACK_DISP0_8
   \   000070   D0E0         POP     A
   \   000072   F0           MOVX    @DPTR,A
    522            if ( dstAddr->addrMode == afAddr64Bit )
   \   000073   8E82         MOV     DPL,R6
   \   000075   8F83         MOV     DPH,R7
   \   000077   E0           MOVX    A,@DPTR
   \   000078   6403         XRL     A,#0x3
   \   00007A   7012         JNZ     ??AF_DataRequest_7
    523              osal_cpyExtAddr( req.dstAddr.addr.extAddr, dstAddr->addr.extAddr );
   \   00007C                ; Setup parameters for call to function sAddrExtCpy
   \   00007C   AC..         MOV     R4,?V0 + 2
   \   00007E   AD..         MOV     R5,?V0 + 3
   \   000080   7402         MOV     A,#0x2
   \   000082   12....       LCALL   ?XSTACK_DISP0_8
   \   000085   AA82         MOV     R2,DPL
   \   000087   AB83         MOV     R3,DPH
   \   000089   12....       LCALL   ??sAddrExtCpy?relay
   \   00008C   8015         SJMP    ??AF_DataRequest_8
    524            else
    525              req.dstAddr.addr.shortAddr = dstAddr->addr.shortAddr;
   \                     ??AF_DataRequest_7:
   \   00008E   85..82       MOV     DPL,?V0 + 2
   \   000091   85..83       MOV     DPH,?V0 + 3
   \   000094   E0           MOVX    A,@DPTR
   \   000095   F8           MOV     R0,A
   \   000096   A3           INC     DPTR
   \   000097   E0           MOVX    A,@DPTR
   \   000098   F9           MOV     R1,A
   \   000099   7402         MOV     A,#0x2
   \   00009B   12....       LCALL   ?XSTACK_DISP0_8
   \   00009E   E8           MOV     A,R0
   \   00009F   F0           MOVX    @DPTR,A
   \   0000A0   A3           INC     DPTR
   \   0000A1   E9           MOV     A,R1
   \   0000A2   F0           MOVX    @DPTR,A
    526            
    527            req.profileID = ZDO_PROFILE_ID;
   \                     ??AF_DataRequest_8:
   \   0000A3   7411         MOV     A,#0x11
   \   0000A5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A8   E4           CLR     A
   \   0000A9   F0           MOVX    @DPTR,A
   \   0000AA   A3           INC     DPTR
   \   0000AB   F0           MOVX    @DPTR,A
    528          
    529            if ( (pfnDescCB = afGetDescCB( srcEP )) )
   \   0000AC                ; Setup parameters for call to function afGetDescCB
   \   0000AC   AA..         MOV     R2,?V0 + 0
   \   0000AE   AB..         MOV     R3,?V0 + 1
   \   0000B0   12....       LCALL   ??afGetDescCB?relay
   \   0000B3   8A..         MOV     ?V0 + 6,R2
   \   0000B5   8B..         MOV     ?V0 + 7,R3
   \   0000B7   A8..         MOV     R0,?V0 + 6
   \   0000B9   A9..         MOV     R1,?V0 + 7
   \   0000BB   E8           MOV     A,R0
   \   0000BC   FC           MOV     R4,A
   \   0000BD   E9           MOV     A,R1
   \   0000BE   FD           MOV     R5,A
   \   0000BF   E8           MOV     A,R0
   \   0000C0   49           ORL     A,R1
   \   0000C1   602D         JZ      ??AF_DataRequest_9
    530            {
    531              uint16 *pID = (uint16 *)(pfnDescCB(
    532                                           AF_DESCRIPTOR_PROFILE_ID, srcEP->endPoint ));
   \   0000C3                ; Setup parameters for indirect call
   \   0000C3   85..82       MOV     DPL,?V0 + 0
   \   0000C6   85..83       MOV     DPH,?V0 + 1
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   FA           MOV     R2,A
   \   0000CB   7902         MOV     R1,#0x2
   \   0000CD   8C82         MOV     DPL,R4
   \   0000CF   8D83         MOV     DPH,R5
   \   0000D1   12....       LCALL   ?CALL_IND
    533              if ( pID )
   \   0000D4   EA           MOV     A,R2
   \   0000D5   4B           ORL     A,R3
   \   0000D6   604B         JZ      ??AF_DataRequest_10
    534              {
    535                req.profileID = *pID;
   \   0000D8   8A82         MOV     DPL,R2
   \   0000DA   8B83         MOV     DPH,R3
   \   0000DC   E0           MOVX    A,@DPTR
   \   0000DD   F8           MOV     R0,A
   \   0000DE   A3           INC     DPTR
   \   0000DF   E0           MOVX    A,@DPTR
   \   0000E0   F9           MOV     R1,A
   \   0000E1   7411         MOV     A,#0x11
   \   0000E3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E6   E8           MOV     A,R0
   \   0000E7   F0           MOVX    @DPTR,A
   \   0000E8   A3           INC     DPTR
   \   0000E9   E9           MOV     A,R1
   \   0000EA   F0           MOVX    @DPTR,A
    536                osal_mem_free( pID );
   \   0000EB                ; Setup parameters for call to function osal_mem_free
   \   0000EB   12....       LCALL   ??osal_mem_free?relay
   \   0000EE   8033         SJMP    ??AF_DataRequest_10
    537              }
    538            }
    539            else if ( srcEP->simpleDesc )
   \                     ??AF_DataRequest_9:
   \   0000F0   E5..         MOV     A,?V0 + 0
   \   0000F2   2403         ADD     A,#0x3
   \   0000F4   F8           MOV     R0,A
   \   0000F5   E5..         MOV     A,?V0 + 1
   \   0000F7   3400         ADDC    A,#0x0
   \   0000F9   F9           MOV     R1,A
   \   0000FA   8882         MOV     DPL,R0
   \   0000FC   8983         MOV     DPH,R1
   \   0000FE   E0           MOVX    A,@DPTR
   \   0000FF   FA           MOV     R2,A
   \   000100   A3           INC     DPTR
   \   000101   E0           MOVX    A,@DPTR
   \   000102   FB           MOV     R3,A
   \   000103   EA           MOV     A,R2
   \   000104   4B           ORL     A,R3
   \   000105   601C         JZ      ??AF_DataRequest_10
    540            {
    541              req.profileID = srcEP->simpleDesc->AppProfId;
   \   000107   8882         MOV     DPL,R0
   \   000109   8983         MOV     DPH,R1
   \   00010B   E0           MOVX    A,@DPTR
   \   00010C   F8           MOV     R0,A
   \   00010D   A3           INC     DPTR
   \   00010E   E0           MOVX    A,@DPTR
   \   00010F   F583         MOV     DPH,A
   \   000111   8882         MOV     DPL,R0
   \   000113   A3           INC     DPTR
   \   000114   E0           MOVX    A,@DPTR
   \   000115   F8           MOV     R0,A
   \   000116   A3           INC     DPTR
   \   000117   E0           MOVX    A,@DPTR
   \   000118   F9           MOV     R1,A
   \   000119   7411         MOV     A,#0x11
   \   00011B   12....       LCALL   ?XSTACK_DISP0_8
   \   00011E   E8           MOV     A,R0
   \   00011F   F0           MOVX    @DPTR,A
   \   000120   A3           INC     DPTR
   \   000121   E9           MOV     A,R1
   \   000122   F0           MOVX    @DPTR,A
    542            }
    543          
    544            req.txOptions = 0;
   \                     ??AF_DataRequest_10:
   \   000123   7417         MOV     A,#0x17
   \   000125   12....       LCALL   ?XSTACK_DISP0_8
   \   000128   E4           CLR     A
   \   000129   F0           MOVX    @DPTR,A
   \   00012A   A3           INC     DPTR
   \   00012B   F0           MOVX    @DPTR,A
    545          
    546            if ( ( options & AF_ACK_REQUEST              ) &&
    547                 ( req.dstAddr.addrMode != AddrBroadcast ) &&
    548                 ( req.dstAddr.addrMode != AddrGroup     )    )
   \   00012C   E5..         MOV     A,?V0 + 4
   \   00012E   A2E4         MOV     C,0xE0 /* A   */.4
   \   000130   501C         JNC     ??AF_DataRequest_11
   \   000132   740A         MOV     A,#0xa
   \   000134   12....       LCALL   ?XSTACK_DISP0_8
   \   000137   E0           MOVX    A,@DPTR
   \   000138   F8           MOV     R0,A
   \   000139   740F         MOV     A,#0xf
   \   00013B   68           XRL     A,R0
   \   00013C   6010         JZ      ??AF_DataRequest_11
   \   00013E   7401         MOV     A,#0x1
   \   000140   68           XRL     A,R0
   \   000141   600B         JZ      ??AF_DataRequest_11
    549            {
    550              req.txOptions |=  APS_TX_OPTIONS_ACK;
   \   000143   7417         MOV     A,#0x17
   \   000145   12....       LCALL   ?XSTACK_DISP0_8
   \   000148   7404         MOV     A,#0x4
   \   00014A   F0           MOVX    @DPTR,A
   \   00014B   A3           INC     DPTR
   \   00014C   E4           CLR     A
   \   00014D   F0           MOVX    @DPTR,A
    551            }
    552          
    553            if ( options & AF_SKIP_ROUTING )
   \                     ??AF_DataRequest_11:
   \   00014E   E5..         MOV     A,?V0 + 4
   \   000150   A2E7         MOV     C,0xE0 /* A   */.7
   \   000152   5009         JNC     ??AF_DataRequest_12
    554            {
    555              req.txOptions |=  APS_TX_OPTIONS_SKIP_ROUTING;
   \   000154   7417         MOV     A,#0x17
   \   000156   12....       LCALL   ?XSTACK_DISP0_8
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   4410         ORL     A,#0x10
   \   00015C   F0           MOVX    @DPTR,A
    556            }
    557          
    558            if ( options & AF_EN_SECURITY )
   \                     ??AF_DataRequest_12:
   \   00015D   E5..         MOV     A,?V0 + 4
   \   00015F   A2E6         MOV     C,0xE0 /* A   */.6
   \   000161   5012         JNC     ??AF_DataRequest_13
    559            {
    560              req.txOptions |= APS_TX_OPTIONS_SECURITY_ENABLE;
   \   000163   7417         MOV     A,#0x17
   \   000165   12....       LCALL   ?XSTACK_DISP0_8
   \   000168   E0           MOVX    A,@DPTR
   \   000169   4401         ORL     A,#0x1
   \   00016B   F0           MOVX    @DPTR,A
    561              mtu.aps.secure = TRUE;
   \   00016C   7401         MOV     A,#0x1
   \   00016E   12....       LCALL   ?XSTACK_DISP0_8
   \   000171   7401         MOV     A,#0x1
   \   000173   8006         SJMP    ??AF_DataRequest_14
    562            }
    563            else
    564            {
    565              mtu.aps.secure = FALSE;
   \                     ??AF_DataRequest_13:
   \   000175   7401         MOV     A,#0x1
   \   000177   12....       LCALL   ?XSTACK_DISP0_8
   \   00017A   E4           CLR     A
   \                     ??AF_DataRequest_14:
   \   00017B   F0           MOVX    @DPTR,A
    566            }
    567          
    568            mtu.kvp = FALSE;
   \   00017C   85..82       MOV     DPL,?XSP + 0
   \   00017F   85..83       MOV     DPH,?XSP + 1
   \   000182   E4           CLR     A
   \   000183   F0           MOVX    @DPTR,A
    569          
    570            req.transID       = *transID;
   \   000184   7434         MOV     A,#0x34
   \   000186   12....       LCALL   ?XSTACK_DISP0_8
   \   000189   E0           MOVX    A,@DPTR
   \   00018A   F8           MOV     R0,A
   \   00018B   A3           INC     DPTR
   \   00018C   E0           MOVX    A,@DPTR
   \   00018D   F583         MOV     DPH,A
   \   00018F   8882         MOV     DPL,R0
   \   000191   E0           MOVX    A,@DPTR
   \   000192   C0E0         PUSH    A
   \   000194   7419         MOV     A,#0x19
   \   000196   12....       LCALL   ?XSTACK_DISP0_8
   \   000199   D0E0         POP     A
   \   00019B   F0           MOVX    @DPTR,A
    571            req.srcEP         = srcEP->endPoint;
   \   00019C   85..82       MOV     DPL,?V0 + 0
   \   00019F   85..83       MOV     DPH,?V0 + 1
   \   0001A2   E0           MOVX    A,@DPTR
   \   0001A3   C0E0         PUSH    A
   \   0001A5   740B         MOV     A,#0xb
   \   0001A7   12....       LCALL   ?XSTACK_DISP0_8
   \   0001AA   D0E0         POP     A
   \   0001AC   F0           MOVX    @DPTR,A
    572            req.dstEP         = dstAddr->endPoint;
   \   0001AD   85..82       MOV     DPL,?V0 + 2
   \   0001B0   85..83       MOV     DPH,?V0 + 3
   \   0001B3   A3           INC     DPTR
   \   0001B4   A3           INC     DPTR
   \   0001B5   A3           INC     DPTR
   \   0001B6   A3           INC     DPTR
   \   0001B7   A3           INC     DPTR
   \   0001B8   A3           INC     DPTR
   \   0001B9   A3           INC     DPTR
   \   0001BA   A3           INC     DPTR
   \   0001BB   A3           INC     DPTR
   \   0001BC   E0           MOVX    A,@DPTR
   \   0001BD   C0E0         PUSH    A
   \   0001BF   740C         MOV     A,#0xc
   \   0001C1   12....       LCALL   ?XSTACK_DISP0_8
   \   0001C4   D0E0         POP     A
   \   0001C6   F0           MOVX    @DPTR,A
    573            req.clusterID     = cID;
   \   0001C7   742E         MOV     A,#0x2e
   \   0001C9   12....       LCALL   ?XSTACK_DISP0_8
   \   0001CC   E0           MOVX    A,@DPTR
   \   0001CD   F8           MOV     R0,A
   \   0001CE   A3           INC     DPTR
   \   0001CF   E0           MOVX    A,@DPTR
   \   0001D0   F9           MOV     R1,A
   \   0001D1   740F         MOV     A,#0xf
   \   0001D3   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D6   E8           MOV     A,R0
   \   0001D7   F0           MOVX    @DPTR,A
   \   0001D8   A3           INC     DPTR
   \   0001D9   E9           MOV     A,R1
   \   0001DA   F0           MOVX    @DPTR,A
    574            req.asduLen       = len;
   \   0001DB   7430         MOV     A,#0x30
   \   0001DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0001E0   E0           MOVX    A,@DPTR
   \   0001E1   F8           MOV     R0,A
   \   0001E2   A3           INC     DPTR
   \   0001E3   E0           MOVX    A,@DPTR
   \   0001E4   F9           MOV     R1,A
   \   0001E5   7413         MOV     A,#0x13
   \   0001E7   12....       LCALL   ?XSTACK_DISP0_8
   \   0001EA   E8           MOV     A,R0
   \   0001EB   F0           MOVX    @DPTR,A
   \   0001EC   A3           INC     DPTR
   \   0001ED   E9           MOV     A,R1
   \   0001EE   F0           MOVX    @DPTR,A
    575            req.asdu          = buf;
   \   0001EF   7432         MOV     A,#0x32
   \   0001F1   12....       LCALL   ?XSTACK_DISP0_8
   \   0001F4   E0           MOVX    A,@DPTR
   \   0001F5   F8           MOV     R0,A
   \   0001F6   A3           INC     DPTR
   \   0001F7   E0           MOVX    A,@DPTR
   \   0001F8   F9           MOV     R1,A
   \   0001F9   7415         MOV     A,#0x15
   \   0001FB   12....       LCALL   ?XSTACK_DISP0_8
   \   0001FE   E8           MOV     A,R0
   \   0001FF   F0           MOVX    @DPTR,A
   \   000200   A3           INC     DPTR
   \   000201   E9           MOV     A,R1
   \   000202   F0           MOVX    @DPTR,A
    576            req.discoverRoute = AF_DataRequestDiscoverRoute;//(uint8)((options & AF_DISCV_ROUTE) ? 1 : 0);
   \   000203   90....       MOV     DPTR,#AF_DataRequestDiscoverRoute
   \   000206   E0           MOVX    A,@DPTR
   \   000207   C0E0         PUSH    A
   \   000209   741A         MOV     A,#0x1a
   \   00020B   12....       LCALL   ?XSTACK_DISP0_8
   \   00020E   D0E0         POP     A
   \   000210   F0           MOVX    @DPTR,A
    577            req.radiusCounter = radius;
   \   000211   741B         MOV     A,#0x1b
   \   000213   12....       LCALL   ?XSTACK_DISP0_8
   \   000216   E5..         MOV     A,?V0 + 5
   \   000218   F0           MOVX    @DPTR,A
    578          #if defined ( INTER_PAN )
    579            req.dstPanId      = dstAddr->panId;
    580          
    581            if ( StubAPS_InterPan( dstAddr->panId, dstAddr->endPoint ) )
    582            {
    583              if ( len > INTERP_DataReqMTU() )
    584              {
    585                stat = afStatus_INVALID_PARAMETER;
    586              }
    587              else
    588              {
    589                stat = INTERP_DataReq( &req );
    590              }
    591            }
    592            else
    593          #endif // INTER_PAN
    594            {
    595              if (len > afDataReqMTU( &mtu ) )
   \   000219                ; Setup parameters for call to function afDataReqMTU
   \   000219   85..82       MOV     DPL,?XSP + 0
   \   00021C   85..83       MOV     DPH,?XSP + 1
   \   00021F   AA82         MOV     R2,DPL
   \   000221   AB83         MOV     R3,DPH
   \   000223   12....       LCALL   ??afDataReqMTU?relay
   \   000226   E9           MOV     A,R1
   \   000227   FA           MOV     R2,A
   \   000228   7430         MOV     A,#0x30
   \   00022A   12....       LCALL   ?XSTACK_DISP0_8
   \   00022D   E0           MOVX    A,@DPTR
   \   00022E   F8           MOV     R0,A
   \   00022F   A3           INC     DPTR
   \   000230   E0           MOVX    A,@DPTR
   \   000231   F9           MOV     R1,A
   \   000232   C3           CLR     C
   \   000233   EA           MOV     A,R2
   \   000234   98           SUBB    A,R0
   \   000235   E4           CLR     A
   \   000236   99           SUBB    A,R1
   \   000237   5029         JNC     ??AF_DataRequest_15
    596              {
    597                if (apsfSendFragmented)
   \   000239   90....       MOV     DPTR,#apsfSendFragmented
   \   00023C   E0           MOVX    A,@DPTR
   \   00023D   F8           MOV     R0,A
   \   00023E   A3           INC     DPTR
   \   00023F   E0           MOVX    A,@DPTR
   \   000240   F9           MOV     R1,A
   \   000241   E8           MOV     A,R0
   \   000242   49           ORL     A,R1
   \   000243   6019         JZ      ??AF_DataRequest_16
    598                {
    599                  stat = (*apsfSendFragmented)( &req );
   \   000245                ; Setup parameters for indirect call
   \   000245   7402         MOV     A,#0x2
   \   000247   12....       LCALL   ?XSTACK_DISP0_8
   \   00024A   AA82         MOV     R2,DPL
   \   00024C   AB83         MOV     R3,DPH
   \   00024E   90....       MOV     DPTR,#apsfSendFragmented
   \   000251   E0           MOVX    A,@DPTR
   \   000252   F8           MOV     R0,A
   \   000253   A3           INC     DPTR
   \   000254   E0           MOVX    A,@DPTR
   \   000255   F583         MOV     DPH,A
   \   000257   8882         MOV     DPL,R0
   \   000259   12....       LCALL   ?CALL_IND
   \   00025C   8010         SJMP    ??AF_DataRequest_17
    600                }
    601                else
    602                {
    603                  stat = afStatus_INVALID_PARAMETER;
   \                     ??AF_DataRequest_16:
   \   00025E   7E02         MOV     R6,#0x2
   \   000260   800E         SJMP    ??AF_DataRequest_18
    604                }
    605              }
    606              else
    607              {
    608                stat = APSDE_DataReq( &req );
   \                     ??AF_DataRequest_15:
   \   000262                ; Setup parameters for call to function APSDE_DataReq
   \   000262   7402         MOV     A,#0x2
   \   000264   12....       LCALL   ?XSTACK_DISP0_8
   \   000267   AA82         MOV     R2,DPL
   \   000269   AB83         MOV     R3,DPH
   \   00026B   12....       LCALL   ??APSDE_DataReq?relay
   \                     ??AF_DataRequest_17:
   \   00026E   E9           MOV     A,R1
   \   00026F   FE           MOV     R6,A
    609              }
    610            }
    611          
    612            /*
    613             * If this is an EndPoint-to-EndPoint message on the same device, it will not
    614             * get added to the NWK databufs. So it will not go OTA and it will not get
    615             * a MACCB_DATA_CONFIRM_CMD callback. Thus it is necessary to generate the
    616             * AF_DATA_CONFIRM_CMD here. Note that APSDE_DataConfirm() only generates one
    617             * message with the first in line TransSeqNumber, even on a multi message.
    618             * Also note that a reflected msg will not have its confirmation generated
    619             * here.
    620             */
    621            if ( (req.dstAddr.addrMode == Addr16Bit) &&
    622                 (req.dstAddr.addr.shortAddr == NLME_GetShortAddr()) )
   \                     ??AF_DataRequest_18:
   \   000270   740A         MOV     A,#0xa
   \   000272   12....       LCALL   ?XSTACK_DISP0_8
   \   000275   E0           MOVX    A,@DPTR
   \   000276   6402         XRL     A,#0x2
   \   000278   7035         JNZ     ??AF_DataRequest_19
   \   00027A                ; Setup parameters for call to function NLME_GetShortAddr
   \   00027A   12....       LCALL   ??NLME_GetShortAddr?relay
   \   00027D   8A..         MOV     ?V0 + 2,R2
   \   00027F   8B..         MOV     ?V0 + 3,R3
   \   000281   A8..         MOV     R0,?V0 + 2
   \   000283   A9..         MOV     R1,?V0 + 3
   \   000285   7402         MOV     A,#0x2
   \   000287   12....       LCALL   ?XSTACK_DISP0_8
   \   00028A   E0           MOVX    A,@DPTR
   \   00028B   68           XRL     A,R0
   \   00028C   7003         JNZ     ??AF_DataRequest_20
   \   00028E   A3           INC     DPTR
   \   00028F   E0           MOVX    A,@DPTR
   \   000290   69           XRL     A,R1
   \                     ??AF_DataRequest_20:
   \   000291   701C         JNZ     ??AF_DataRequest_19
    623            {
    624              afDataConfirm( srcEP->endPoint, *transID, stat );
   \   000293                ; Setup parameters for call to function afDataConfirm
   \   000293   EE           MOV     A,R6
   \   000294   FB           MOV     R3,A
   \   000295   7434         MOV     A,#0x34
   \   000297   12....       LCALL   ?XSTACK_DISP0_8
   \   00029A   E0           MOVX    A,@DPTR
   \   00029B   F8           MOV     R0,A
   \   00029C   A3           INC     DPTR
   \   00029D   E0           MOVX    A,@DPTR
   \   00029E   F583         MOV     DPH,A
   \   0002A0   8882         MOV     DPL,R0
   \   0002A2   E0           MOVX    A,@DPTR
   \   0002A3   FA           MOV     R2,A
   \   0002A4   85..82       MOV     DPL,?V0 + 0
   \   0002A7   85..83       MOV     DPH,?V0 + 1
   \   0002AA   E0           MOVX    A,@DPTR
   \   0002AB   F9           MOV     R1,A
   \   0002AC   12....       LCALL   ??afDataConfirm?relay
    625            }
    626          
    627            if ( stat == afStatus_SUCCESS )
   \                     ??AF_DataRequest_19:
   \   0002AF   EE           MOV     A,R6
   \   0002B0   7010         JNZ     ??AF_DataRequest_21
    628            {
    629              (*transID)++;
   \   0002B2   7434         MOV     A,#0x34
   \   0002B4   12....       LCALL   ?XSTACK_DISP0_8
   \   0002B7   E0           MOVX    A,@DPTR
   \   0002B8   F8           MOV     R0,A
   \   0002B9   A3           INC     DPTR
   \   0002BA   E0           MOVX    A,@DPTR
   \   0002BB   F583         MOV     DPH,A
   \   0002BD   8882         MOV     DPL,R0
   \   0002BF   E0           MOVX    A,@DPTR
   \   0002C0   04           INC     A
   \   0002C1   F0           MOVX    @DPTR,A
    630            }
    631          
    632            return (afStatus_t)stat;
   \                     ??AF_DataRequest_21:
   \   0002C2   EE           MOV     A,R6
   \   0002C3   F9           MOV     R1,A
   \                     ??AF_DataRequest_2:
   \   0002C4   741E         MOV     A,#0x1e
   \   0002C6   12....       LCALL   ?DEALLOC_XSTACK8
   \   0002C9   7F08         MOV     R7,#0x8
   \   0002CB   02....       LJMP    ?BANKED_LEAVE_XDATA
    633          }
    634          
    635          /*********************************************************************
    636           * @fn      afFindEndPointDescList
    637           *
    638           * @brief   Find the endpoint description entry from the endpoint
    639           *          number.
    640           *
    641           * @param   EndPoint - Application Endpoint to look for
    642           *
    643           * @return  the address to the endpoint/interface description entry
    644           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    645          static epList_t *afFindEndPointDescList( byte EndPoint )
   \                     afFindEndPointDescList:
    646          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    647            epList_t *epSearch;
    648          
    649            // Start at the beginning
    650            epSearch = epList;
   \   000004   90....       MOV     DPTR,#epList
   \   000007   8009         SJMP    ??afFindEndPointDescList_0
    651          
    652            // Look through the list until the end
    653            while ( epSearch )
    654            {
    655              // Is there a match?
    656              if ( epSearch->epDesc->endPoint == EndPoint )
    657              {
    658                return ( epSearch );
    659              }
    660              else
    661                epSearch = epSearch->nextDesc;  // Next entry
   \                     ??afFindEndPointDescList_1:
   \   000009   8A82         MOV     DPL,R2
   \   00000B   8B83         MOV     DPH,R3
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \                     ??afFindEndPointDescList_0:
   \   000012   E0           MOVX    A,@DPTR
   \   000013   FA           MOV     R2,A
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   FB           MOV     R3,A
   \   000017   EA           MOV     A,R2
   \   000018   4B           ORL     A,R3
   \   000019   6012         JZ      ??afFindEndPointDescList_2
   \   00001B   8A82         MOV     DPL,R2
   \   00001D   8B83         MOV     DPH,R3
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F8           MOV     R0,A
   \   000021   A3           INC     DPTR
   \   000022   E0           MOVX    A,@DPTR
   \   000023   F583         MOV     DPH,A
   \   000025   8882         MOV     DPL,R0
   \   000027   E0           MOVX    A,@DPTR
   \   000028   69           XRL     A,R1
   \   000029   70DE         JNZ     ??afFindEndPointDescList_1
   \   00002B   8004         SJMP    ??afFindEndPointDescList_3
    662            }
    663          
    664            return ( (epList_t *)NULL );
   \                     ??afFindEndPointDescList_2:
   \   00002D   7A00         MOV     R2,#0x0
   \   00002F   7B00         MOV     R3,#0x0
   \                     ??afFindEndPointDescList_3:
   \   000031   D083         POP     DPH
   \   000033   D082         POP     DPL
   \   000035   02....       LJMP    ?BRET
    665          }
    666          
    667          /*********************************************************************
    668           * @fn      afFindEndPointDesc
    669           *
    670           * @brief   Find the endpoint description entry from the endpoint
    671           *          number.
    672           *
    673           * @param   EndPoint - Application Endpoint to look for
    674           *
    675           * @return  the address to the endpoint/interface description entry
    676           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    677          endPointDesc_t *afFindEndPointDesc( byte EndPoint )
   \                     afFindEndPointDesc:
    678          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    679            epList_t *epSearch;
    680          
    681            // Look for the endpoint
    682            epSearch = afFindEndPointDescList( EndPoint );
   \   000005                ; Setup parameters for call to function afFindEndPointDescList
   \   000005   12....       LCALL   ??afFindEndPointDescList?relay
   \   000008   8A82         MOV     DPL,R2
   \   00000A   8B83         MOV     DPH,R3
    683          
    684            if ( epSearch )
   \   00000C   E582         MOV     A,DPL
   \   00000E   4583         ORL     A,DPH
   \   000010   6007         JZ      ??afFindEndPointDesc_0
    685              return ( epSearch->epDesc );
   \   000012   E0           MOVX    A,@DPTR
   \   000013   FA           MOV     R2,A
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   FB           MOV     R3,A
   \   000017   8004         SJMP    ??afFindEndPointDesc_1
    686            else
    687              return ( (endPointDesc_t *)NULL );
   \                     ??afFindEndPointDesc_0:
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7B00         MOV     R3,#0x0
   \                     ??afFindEndPointDesc_1:
   \   00001D   7F02         MOV     R7,#0x2
   \   00001F   02....       LJMP    ?BANKED_LEAVE_XDATA
    688          }
    689          
    690          /*********************************************************************
    691           * @fn      afFindSimpleDesc
    692           *
    693           * @brief   Find the Simple Descriptor from the endpoint number.
    694           *
    695           * @param   EP - Application Endpoint to look for.
    696           *
    697           * @return  Non-zero to indicate that the descriptor memory must be freed.
    698           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    699          byte afFindSimpleDesc( SimpleDescriptionFormat_t **ppDesc, byte EP )
   \                     afFindSimpleDesc:
    700          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   89..         MOV     ?V0 + 0,R1
    701            epList_t *epItem = afFindEndPointDescList( EP );
   \   00000B                ; Setup parameters for call to function afFindEndPointDescList
   \   00000B   12....       LCALL   ??afFindEndPointDescList?relay
    702            byte rtrn = FALSE;
   \   00000E   75..00       MOV     ?V0 + 1,#0x0
    703          
    704            if ( epItem )
   \   000011   EA           MOV     A,R2
   \   000012   4B           ORL     A,R3
   \   000013   6058         JZ      ??afFindSimpleDesc_0
    705            {
    706              if ( epItem->pfnDescCB )
   \   000015   EA           MOV     A,R2
   \   000016   2403         ADD     A,#0x3
   \   000018   F8           MOV     R0,A
   \   000019   EB           MOV     A,R3
   \   00001A   3400         ADDC    A,#0x0
   \   00001C   F9           MOV     R1,A
   \   00001D   E8           MOV     A,R0
   \   00001E   FC           MOV     R4,A
   \   00001F   E9           MOV     A,R1
   \   000020   FD           MOV     R5,A
   \   000021   8C82         MOV     DPL,R4
   \   000023   8D83         MOV     DPH,R5
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F8           MOV     R0,A
   \   000027   A3           INC     DPTR
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F9           MOV     R1,A
   \   00002A   E8           MOV     A,R0
   \   00002B   49           ORL     A,R1
   \   00002C   6021         JZ      ??afFindSimpleDesc_1
    707              {
    708                *ppDesc = epItem->pfnDescCB( AF_DESCRIPTOR_SIMPLE, EP );
   \   00002E                ; Setup parameters for indirect call
   \   00002E   AA..         MOV     R2,?V0 + 0
   \   000030   7901         MOV     R1,#0x1
   \   000032   8C82         MOV     DPL,R4
   \   000034   8D83         MOV     DPH,R5
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F8           MOV     R0,A
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   F583         MOV     DPH,A
   \   00003C   8882         MOV     DPL,R0
   \   00003E   12....       LCALL   ?CALL_IND
   \   000041   8E82         MOV     DPL,R6
   \   000043   8F83         MOV     DPH,R7
   \   000045   EA           MOV     A,R2
   \   000046   F0           MOVX    @DPTR,A
   \   000047   A3           INC     DPTR
   \   000048   EB           MOV     A,R3
   \   000049   F0           MOVX    @DPTR,A
    709                rtrn = TRUE;
   \   00004A   75..01       MOV     ?V0 + 1,#0x1
   \   00004D   8026         SJMP    ??afFindSimpleDesc_2
    710              }
    711              else
    712              {
    713                *ppDesc = epItem->epDesc->simpleDesc;
   \                     ??afFindSimpleDesc_1:
   \   00004F   8A82         MOV     DPL,R2
   \   000051   8B83         MOV     DPH,R3
   \   000053   E0           MOVX    A,@DPTR
   \   000054   F8           MOV     R0,A
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F583         MOV     DPH,A
   \   000059   8882         MOV     DPL,R0
   \   00005B   A3           INC     DPTR
   \   00005C   A3           INC     DPTR
   \   00005D   A3           INC     DPTR
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   F8           MOV     R0,A
   \   000060   A3           INC     DPTR
   \   000061   E0           MOVX    A,@DPTR
   \   000062   F9           MOV     R1,A
   \   000063   8E82         MOV     DPL,R6
   \   000065   8F83         MOV     DPH,R7
   \   000067   E8           MOV     A,R0
   \   000068   F0           MOVX    @DPTR,A
   \   000069   A3           INC     DPTR
   \   00006A   E9           MOV     A,R1
   \   00006B   8007         SJMP    ??afFindSimpleDesc_3
    714              }
    715            }
    716            else
    717            {
    718              *ppDesc = NULL;
   \                     ??afFindSimpleDesc_0:
   \   00006D   8E82         MOV     DPL,R6
   \   00006F   8F83         MOV     DPH,R7
   \   000071   E4           CLR     A
   \   000072   F0           MOVX    @DPTR,A
   \   000073   A3           INC     DPTR
   \                     ??afFindSimpleDesc_3:
   \   000074   F0           MOVX    @DPTR,A
    719            }
    720          
    721            return rtrn;
   \                     ??afFindSimpleDesc_2:
   \   000075   A9..         MOV     R1,?V0 + 1
   \   000077   7F04         MOV     R7,#0x4
   \   000079   02....       LJMP    ?BANKED_LEAVE_XDATA
    722          }
    723          
    724          /*********************************************************************
    725           * @fn      afGetDescCB
    726           *
    727           * @brief   Get the Descriptor callback function.
    728           *
    729           * @param   epDesc - pointer to the endpoint descriptor
    730           *
    731           * @return  function pointer or NULL
    732           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    733          static pDescCB afGetDescCB( endPointDesc_t *epDesc )
   \                     afGetDescCB:
    734          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    735            epList_t *epSearch;
    736          
    737            // Start at the beginning
    738            epSearch = epList;
   \   000004   90....       MOV     DPTR,#epList
   \   000007   8002         SJMP    ??afGetDescCB_0
    739          
    740            // Look through the list until the end
    741            while ( epSearch )
    742            {
    743              // Is there a match?
    744              if ( epSearch->epDesc == epDesc )
    745              {
    746                return ( epSearch->pfnDescCB );
    747              }
    748              else
    749                epSearch = epSearch->nextDesc;  // Next entry
   \                     ??afGetDescCB_1:
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \                     ??afGetDescCB_0:
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F8           MOV     R0,A
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   F9           MOV     R1,A
   \   000010   E8           MOV     A,R0
   \   000011   49           ORL     A,R1
   \   000012   601F         JZ      ??afGetDescCB_2
   \   000014   8882         MOV     DPL,R0
   \   000016   8983         MOV     DPH,R1
   \   000018   E0           MOVX    A,@DPTR
   \   000019   FC           MOV     R4,A
   \   00001A   A3           INC     DPTR
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   FD           MOV     R5,A
   \   00001D   EA           MOV     A,R2
   \   00001E   6C           XRL     A,R4
   \   00001F   7002         JNZ     ??afGetDescCB_3
   \   000021   EB           MOV     A,R3
   \   000022   6D           XRL     A,R5
   \                     ??afGetDescCB_3:
   \   000023   8882         MOV     DPL,R0
   \   000025   8983         MOV     DPH,R1
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   70DD         JNZ     ??afGetDescCB_1
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   FA           MOV     R2,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   FB           MOV     R3,A
   \   000031   8004         SJMP    ??afGetDescCB_4
    750            }
    751          
    752            return ( (pDescCB)NULL );
   \                     ??afGetDescCB_2:
   \   000033   7A00         MOV     R2,#0x0
   \   000035   7B00         MOV     R3,#0x0
   \                     ??afGetDescCB_4:
   \   000037   D083         POP     DPH
   \   000039   D082         POP     DPL
   \   00003B   02....       LJMP    ?BRET
    753          }
    754          
    755          /*********************************************************************
    756           * @fn      afDataReqMTU
    757           *
    758           * @brief   Get the Data Request MTU(Max Transport Unit).
    759           *
    760           * @param   fields - afDataReqMTU_t
    761           *
    762           * @return  uint8(MTU)
    763           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    764          uint8 afDataReqMTU( afDataReqMTU_t* fields )
   \                     afDataReqMTU:
    765          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    766            uint8 len;
    767            uint8 hdr;
    768          
    769            if ( fields->kvp == TRUE )
   \   000005   8A82         MOV     DPL,R2
   \   000007   8B83         MOV     DPH,R3
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   6401         XRL     A,#0x1
   \   00000C   7004         JNZ     ??afDataReqMTU_0
    770            {
    771              hdr = AF_HDR_KVP_MAX_LEN;
   \   00000E   7E08         MOV     R6,#0x8
   \   000010   8002         SJMP    ??afDataReqMTU_1
    772            }
    773            else
    774            {
    775              hdr = AF_HDR_V1_1_MAX_LEN;
   \                     ??afDataReqMTU_0:
   \   000012   7E00         MOV     R6,#0x0
    776            }
    777          
    778            len = (uint8)(APSDE_DataReqMTU(&fields->aps) - hdr);
   \                     ??afDataReqMTU_1:
   \   000014                ; Setup parameters for call to function APSDE_DataReqMTU
   \   000014   A3           INC     DPTR
   \   000015   AA82         MOV     R2,DPL
   \   000017   AB83         MOV     R3,DPH
   \   000019   12....       LCALL   ??APSDE_DataReqMTU?relay
   \   00001C   E9           MOV     A,R1
   \   00001D   C3           CLR     C
   \   00001E   9E           SUBB    A,R6
   \   00001F   F9           MOV     R1,A
    779          
    780            return len;
   \   000020   7F01         MOV     R7,#0x1
   \   000022   02....       LJMP    ?BANKED_LEAVE_XDATA
    781          }
    782          
    783          /*********************************************************************
    784           * @fn      afGetMatch
    785           *
    786           * @brief   Set the allow response flag.
    787           *
    788           * @param   ep - Application Endpoint to look for
    789           * @param   action - true - allow response, false - no response
    790           *
    791           * @return  TRUE allow responses, FALSE no response
    792           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    793          uint8 afGetMatch( uint8 ep )
   \                     afGetMatch:
    794          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    795            epList_t *epSearch;
    796          
    797            // Look for the endpoint
    798            epSearch = afFindEndPointDescList( ep );
   \   000005                ; Setup parameters for call to function afFindEndPointDescList
   \   000005   12....       LCALL   ??afFindEndPointDescList?relay
   \   000008   8A82         MOV     DPL,R2
   \   00000A   8B83         MOV     DPH,R3
    799          
    800            if ( epSearch )
   \   00000C   E582         MOV     A,DPL
   \   00000E   4583         ORL     A,DPH
   \   000010   600B         JZ      ??afGetMatch_0
    801            {
    802              if ( epSearch->flags & eEP_AllowMatch )
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   A2E0         MOV     C,0xE0 /* A   */.0
   \   000017   5004         JNC     ??afGetMatch_0
    803                return ( TRUE );
   \   000019   7901         MOV     R1,#0x1
   \   00001B   8002         SJMP    ??afGetMatch_1
    804              else
    805                return ( FALSE );
   \                     ??afGetMatch_0:
   \   00001D   7900         MOV     R1,#0x0
   \                     ??afGetMatch_1:
   \   00001F   7F02         MOV     R7,#0x2
   \   000021   02....       LJMP    ?BANKED_LEAVE_XDATA
    806            }
    807            else
    808              return ( FALSE );
    809          }
    810          
    811          /*********************************************************************
    812           * @fn      afSetMatch
    813           *
    814           * @brief   Set the allow response flag.
    815           *
    816           * @param   ep - Application Endpoint to look for
    817           * @param   action - true - allow response, false - no response
    818           *
    819           * @return  TRUE if success, FALSE if endpoint not found
    820           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    821          uint8 afSetMatch( uint8 ep, uint8 action )
   \                     afSetMatch:
    822          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FF           MOV     R7,A
    823            epList_t *epSearch;
    824          
    825            // Look for the endpoint
    826            epSearch = afFindEndPointDescList( ep );
   \   000007                ; Setup parameters for call to function afFindEndPointDescList
   \   000007   12....       LCALL   ??afFindEndPointDescList?relay
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   A8..         MOV     R0,?V0 + 0
   \   000010   A9..         MOV     R1,?V0 + 1
    827          
    828            if ( epSearch )
   \   000012   E8           MOV     A,R0
   \   000013   49           ORL     A,R1
   \   000014   601A         JZ      ??afSetMatch_0
    829            {
    830              if ( action )
   \   000016   E8           MOV     A,R0
   \   000017   2402         ADD     A,#0x2
   \   000019   F582         MOV     DPL,A
   \   00001B   E9           MOV     A,R1
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   F583         MOV     DPH,A
   \   000020   EF           MOV     A,R7
   \   000021   6005         JZ      ??afSetMatch_1
    831              {
    832                epSearch->flags |= eEP_AllowMatch;
   \   000023   E0           MOVX    A,@DPTR
   \   000024   D2E0         SETB    0xE0 /* A   */.0
   \   000026   8003         SJMP    ??afSetMatch_2
    833              }
    834              else
    835              {
    836                epSearch->flags &= (eEP_AllowMatch ^ 0xFFFF);
   \                     ??afSetMatch_1:
   \   000028   E0           MOVX    A,@DPTR
   \   000029   C2E0         CLR     0xE0 /* A   */.0
   \                     ??afSetMatch_2:
   \   00002B   F0           MOVX    @DPTR,A
    837              }
    838              return ( TRUE );
   \   00002C   7901         MOV     R1,#0x1
   \   00002E   8002         SJMP    ??afSetMatch_3
    839            }
    840            else
    841              return ( FALSE );
   \                     ??afSetMatch_0:
   \   000030   7900         MOV     R1,#0x0
   \                     ??afSetMatch_3:
   \   000032   7F02         MOV     R7,#0x2
   \   000034   02....       LJMP    ?BANKED_LEAVE_XDATA
    842          }
    843          
    844          /*********************************************************************
    845           * @fn      afNumEndPoints
    846           *
    847           * @brief   Returns the number of endpoints defined (including 0)
    848           *
    849           * @param   none
    850           *
    851           * @return  number of endpoints
    852           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    853          byte afNumEndPoints( void )
   \                     afNumEndPoints:
    854          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    855            epList_t *epSearch;
    856            byte endpoints;
    857          
    858            // Start at the beginning
    859            epSearch = epList;
   \   000004   90....       MOV     DPTR,#epList
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F8           MOV     R0,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F9           MOV     R1,A
   \   00000C   8882         MOV     DPL,R0
   \   00000E   8983         MOV     DPH,R1
    860            endpoints = 0;
   \   000010   7900         MOV     R1,#0x0
   \   000012   800F         SJMP    ??afNumEndPoints_0
    861          
    862            while ( epSearch )
    863            {
    864              endpoints++;
   \                     ??afNumEndPoints_1:
   \   000014   09           INC     R1
    865              epSearch = epSearch->nextDesc;
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   A3           INC     DPTR
   \   000018   A3           INC     DPTR
   \   000019   A3           INC     DPTR
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   FA           MOV     R2,A
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FB           MOV     R3,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
    866            }
   \                     ??afNumEndPoints_0:
   \   000023   E582         MOV     A,DPL
   \   000025   4583         ORL     A,DPH
   \   000027   70EB         JNZ     ??afNumEndPoints_1
    867          
    868            return ( endpoints );
   \   000029   D083         POP     DPH
   \   00002B   D082         POP     DPL
   \   00002D   02....       LJMP    ?BRET
    869          }
    870          
    871          /*********************************************************************
    872           * @fn      afEndPoints
    873           *
    874           * @brief   Fills in the passed in buffer with the endpoint (numbers).
    875           *          Use afNumEndPoints to find out how big a buffer to supply.
    876           *
    877           * @param   epBuf - pointer to mem used
    878           *
    879           * @return  void
    880           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    881          void afEndPoints( byte *epBuf, byte skipZDO )
   \                     afEndPoints:
    882          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FC           MOV     R4,A
    883            epList_t *epSearch;
    884            byte endPoint;
    885          
    886            // Start at the beginning
    887            epSearch = epList;
   \   000006   90....       MOV     DPTR,#epList
   \   000009   8028         SJMP    ??afEndPoints_0
    888          
    889            while ( epSearch )
    890            {
    891              endPoint = epSearch->epDesc->endPoint;
   \                     ??afEndPoints_1:
   \   00000B   8882         MOV     DPL,R0
   \   00000D   8983         MOV     DPH,R1
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   FD           MOV     R5,A
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   F583         MOV     DPH,A
   \   000015   8D82         MOV     DPL,R5
   \   000017   E0           MOVX    A,@DPTR
   \   000018   FD           MOV     R5,A
    892          
    893              if ( !skipZDO || endPoint != 0 )
   \   000019   EC           MOV     A,R4
   \   00001A   6003         JZ      ??afEndPoints_2
   \   00001C   ED           MOV     A,R5
   \   00001D   600B         JZ      ??afEndPoints_3
    894                *epBuf++ = endPoint;
   \                     ??afEndPoints_2:
   \   00001F   ED           MOV     A,R5
   \   000020   8A82         MOV     DPL,R2
   \   000022   8B83         MOV     DPH,R3
   \   000024   F0           MOVX    @DPTR,A
   \   000025   A3           INC     DPTR
   \   000026   AA82         MOV     R2,DPL
   \   000028   AB83         MOV     R3,DPH
    895          
    896              epSearch = epSearch->nextDesc;
   \                     ??afEndPoints_3:
   \   00002A   8882         MOV     DPL,R0
   \   00002C   8983         MOV     DPH,R1
   \   00002E   A3           INC     DPTR
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   A3           INC     DPTR
   \   000032   A3           INC     DPTR
   \                     ??afEndPoints_0:
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F8           MOV     R0,A
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F9           MOV     R1,A
    897            }
   \   000038   E8           MOV     A,R0
   \   000039   49           ORL     A,R1
   \   00003A   70CF         JNZ     ??afEndPoints_1
    898          }
   \   00003C   D083         POP     DPH
   \   00003E   D082         POP     DPL
   \   000040   02....       LJMP    ?BRET
    899          
    900          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    901          void afCopyAddress ( afAddrType_t *afAddr, zAddrType_t *zAddr )
   \                     afCopyAddress:
    902          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    903            afAddr->addrMode = (afAddrMode_t)zAddr->addrMode;
   \   000005   EC           MOV     A,R4
   \   000006   2408         ADD     A,#0x8
   \   000008   F8           MOV     R0,A
   \   000009   ED           MOV     A,R5
   \   00000A   3400         ADDC    A,#0x0
   \   00000C   F9           MOV     R1,A
   \   00000D   8882         MOV     DPL,R0
   \   00000F   8983         MOV     DPH,R1
   \   000011   E0           MOVX    A,@DPTR
   \   000012   8A82         MOV     DPL,R2
   \   000014   8B83         MOV     DPH,R3
   \   000016   A3           INC     DPTR
   \   000017   A3           INC     DPTR
   \   000018   A3           INC     DPTR
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   A3           INC     DPTR
   \   00001E   F0           MOVX    @DPTR,A
    904            if ( zAddr->addrMode == Addr64Bit )
   \   00001F   8882         MOV     DPL,R0
   \   000021   8983         MOV     DPH,R1
   \   000023   E0           MOVX    A,@DPTR
   \   000024   6403         XRL     A,#0x3
   \   000026   7005         JNZ     ??afCopyAddress_0
    905              osal_cpyExtAddr( afAddr->addr.extAddr, zAddr->addr.extAddr );
   \   000028                ; Setup parameters for call to function sAddrExtCpy
   \   000028   12....       LCALL   ??sAddrExtCpy?relay
   \   00002B   8012         SJMP    ??afCopyAddress_1
    906            else
    907              afAddr->addr.shortAddr = zAddr->addr.shortAddr;
   \                     ??afCopyAddress_0:
   \   00002D   8C82         MOV     DPL,R4
   \   00002F   8D83         MOV     DPH,R5
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F8           MOV     R0,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F9           MOV     R1,A
   \   000036   8A82         MOV     DPL,R2
   \   000038   8B83         MOV     DPH,R3
   \   00003A   E8           MOV     A,R0
   \   00003B   F0           MOVX    @DPTR,A
   \   00003C   A3           INC     DPTR
   \   00003D   E9           MOV     A,R1
   \   00003E   F0           MOVX    @DPTR,A
    908          }
   \                     ??afCopyAddress_1:
   \   00003F   7F01         MOV     R7,#0x1
   \   000041   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for AF_DataRequestDiscoverRoute>`:
   \   000000   01           DB 1

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afRegisterExtended?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afRegisterExtended

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afRegister?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afRegister

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afDataConfirm?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afDataConfirm

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afIncomingData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afIncomingData

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afBuildMSGIncoming?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afBuildMSGIncoming

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AF_DataRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AF_DataRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afFindEndPointDescList?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afFindEndPointDescList

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afFindEndPointDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afFindEndPointDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afFindSimpleDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afFindSimpleDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afGetDescCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afGetDescCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afDataReqMTU?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afDataReqMTU

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afGetMatch?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afGetMatch

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afSetMatch?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afSetMatch

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afNumEndPoints?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afNumEndPoints

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afEndPoints?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afEndPoints

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afCopyAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afCopyAddress
    909          
    910          /*********************************************************************
    911          *********************************************************************/
    912          

   Maximum stack usage in bytes:

     Function                      ISTACK PSTACK XSTACK
     --------                      ------ ------ ------
     AF_DataRequest                    1      0     55
       -> NLME_IsAddressBroadcast      0      0     92
       -> sAddrExtCpy                  0      0     92
       -> afGetDescCB                  0      0     92
       -> osal_mem_free                0      0     92
       -> afDataReqMTU                 0      0     92
       -> APSDE_DataReq                0      0     92
       -> NLME_GetShortAddr            0      0     92
       -> afDataConfirm                0      0     92
     afBuildMSGIncoming                1      0     56
       -> osal_msg_allocate            0      0     38
       -> afCopyAddress                0      0     38
       -> osal_memcpy                  0      0     44
       -> osal_msg_send                0      0     38
     afCopyAddress                     1      0     28
       -> sAddrExtCpy                  0      0     18
     afDataConfirm                     1      0     60
       -> afFindEndPointDesc           0      0     28
       -> osal_msg_allocate            0      0     28
       -> osal_msg_send                0      0     28
     afDataReqMTU                      0      0     55
       -> APSDE_DataReqMTU             0      0     18
     afEndPoints                       3      0      0
     afFindEndPointDesc                0      0     34
       -> afFindEndPointDescList       0      0     20
     afFindEndPointDescList            2      0     24
     afFindSimpleDesc                  0      0     12
       -> afFindEndPointDescList       0      0     24
     afGetDescCB                       2      0     46
     afGetMatch                        0      0     10
       -> afFindEndPointDescList       0      0     20
     afIncomingData                    1      0     42
       -> aps_FindGroupForEndpoint     0      0     48
       -> afFindEndPointDesc           0      0     48
       -> afFindEndPointDescList       0      0     48
       -> afFindEndPointDesc           0      0     48
       -> aps_FindGroupForEndpoint     0      0     48
       -> afFindEndPointDesc           0      0     48
       -> afFindEndPointDescList       0      0     48
       -> osal_mem_free                0      0     48
       -> afBuildMSGIncoming           0      0     68
     afInit                            2      0      0
     afNumEndPoints                    2      0      0
     afRegister                        0      0     10
       -> afFindEndPointDescList       0      0     20
       -> afRegisterExtended           0      0     20
     afRegisterExtended                0      0     22
       -> osal_mem_alloc               0      0     24
     afSetMatch                        0      0     10
       -> afFindEndPointDescList       0      0     20


   Segment part sizes:

     Function/Label                                 Bytes
     --------------                                 -----
     epList                                            2
     afInit                                           18
     afRegisterExtended                              124
     afRegister                                       58
     afDataConfirm                                    87
     afIncomingData                                  642
     afBuildMSGIncoming                              620
     AF_DataRequestDiscoverRoute                       1
     AF_DataRequest                                  718
     afFindEndPointDescList                           56
     afFindEndPointDesc                               34
     afFindSimpleDesc                                124
     afGetDescCB                                      62
     afDataReqMTU                                     37
     afGetMatch                                       36
     afSetMatch                                       55
     afNumEndPoints                                   48
     afEndPoints                                      67
     afCopyAddress                                    68
     ?<Initializer for AF_DataRequestDiscoverRoute>    1
     ??afInit?relay                                    6
     ??afRegisterExtended?relay                        6
     ??afRegister?relay                                6
     ??afDataConfirm?relay                             6
     ??afIncomingData?relay                            6
     ??afBuildMSGIncoming?relay                        6
     ??AF_DataRequest?relay                            6
     ??afFindEndPointDescList?relay                    6
     ??afFindEndPointDesc?relay                        6
     ??afFindSimpleDesc?relay                          6
     ??afGetDescCB?relay                               6
     ??afDataReqMTU?relay                              6
     ??afGetMatch?relay                                6
     ??afSetMatch?relay                                6
     ??afNumEndPoints?relay                            6
     ??afEndPoints?relay                               6
     ??afCopyAddress?relay                             6

 
 2 854 bytes in segment BANKED_CODE
   102 bytes in segment BANK_RELAYS
     1 byte  in segment XDATA_I
     1 byte  in segment XDATA_ID
     2 bytes in segment XDATA_Z
 
 2 957 bytes of CODE  memory
     3 bytes of XDATA memory

Errors: none
Warnings: none
