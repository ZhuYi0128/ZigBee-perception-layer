###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         08/Aug/2016  14:20:43 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Users\zhuyi\Desktop\2016 µçÈü                   #
#                          ¾öÈü\8.6\Components\mac\low_level\srf04\mac_autope #
#                          nd.c                                               #
#    Command line       =  -f "C:\Users\zhuyi\Desktop\2016 µçÈü               #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg"          #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"         #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Components\mac\low_level\srf04\mac_autope #
#                          nd.c" -D ZIGBEEPRO -D HAL_UART=TRUE -D             #
#                          SERIAL_APP_PORT=0 -D LCD_SUPPORTED -D NV_RESTORE   #
#                          -lC "C:\Users\zhuyi\Desktop\2016 µçÈü              #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\List\" -lA                   #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\List\" --diag_suppress       #
#                          Pe001,Pa010 -o "C:\Users\zhuyi\Desktop\2016 µçÈü   #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\Obj\" -e --no_unroll         #
#                          --no_inline --no_tbaa --debug --core=plain         #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 8 -I "C:\Users\zhuyi\Desktop\201 #
#                          6 µçÈü  ¾öÈü\8.6\Projects\zstack\Utilities\SerialA #
#                          pp\CC2530DB\" -I "C:\Users\zhuyi\Desktop\2016      #
#                          µçÈü  ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp #
#                          \CC2530DB\..\SOURCE\" -I                           #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\ZMAIN\TI2530DB\" -I                   #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MT\" -I              #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\" -I     #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\ #
#                          " -I "C:\Users\zhuyi\Desktop\2016 µçÈü             #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\" -I  #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\" -I    #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\AF\" -I        #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\NWK\" -I       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\SEC\" -I       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\" -I      #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\SYS\" -I       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\" -I       #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\" -I        #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\ZMAC\" -I            #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\" -I  #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA\" -I  #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\" -I     #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\" -I  #
#                          "C:\Users\zhuyi\Desktop\2016 µçÈü                  #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\ #
#                          " -I "C:\Users\zhuyi\Desktop\2016 µçÈü             #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\ #
#                          SINGLE_CHIP\" -Om --require_prototypes             #
#    List file          =  C:\Users\zhuyi\Desktop\2016 µçÈü                   #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\List\mac_autopend.lst        #
#    Object file        =  C:\Users\zhuyi\Desktop\2016 µçÈü                   #
#                          ¾öÈü\8.6\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\CoordinatorEB-Pro\Obj\mac_autopend.r51         #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\zhuyi\Desktop\2016 µçÈü  ¾öÈü\8.6\Components\mac\low_level\srf04\mac_autopend.c
      1          /**************************************************************************************************
      2            Filename:       mac_autopend.c
      3            Revised:        $Date: 2008-07-31 17:11:07 -0700 (Thu, 31 Jul 2008) $
      4            Revision:       $Revision: 17677 $
      5          
      6            Description:    This file implements the TIMAC Autopend feature.
      7          
      8          
      9            Copyright 2006-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /* low-level */
     41          #include "mac_api.h"
     42          #include "mac_radio_defs.h"
     43          
     44          /* osal */
     45          #include "OSAL.h"
     46          #include "saddr.h"
     47          #include "ZComDef.h"
     48          
     49          #include "mac_autopend.h"
     50          
     51          /* ------------------------------------------------------------------------------------------------
     52           *                                           Defines
     53           * ------------------------------------------------------------------------------------------------
     54           */
     55          #define MAC_SRCMATCH_INVALID_INDEX           0xFF
     56          
     57          #define MAC_SRCMATCH_SHORT_ENTRY_SIZE        4
     58          #define MAC_SRCMATCH_EXT_ENTRY_SIZE          Z_EXTADDR_LEN
     59          
     60          #define MAC_SRCMATCH_SHORT_MAX_NUM_ENTRIES   24
     61          #define MAC_SRCMATCH_EXT_MAX_NUM_ENTRIES     12
     62          
     63          #define MAC_SRCMATCH_ENABLE_BITMAP_LEN       3
     64                    
     65          
     66          /* ------------------------------------------------------------------------------------------------
     67           *                                      Global Variables
     68           * ------------------------------------------------------------------------------------------------
     69           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     70          bool macSrcMatchIsEnabled = FALSE; 
   \                     macSrcMatchIsEnabled:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     71          
     72          
     73          /* ------------------------------------------------------------------------------------------------
     74           *                                         Local Variables
     75           * ------------------------------------------------------------------------------------------------
     76           */
     77          
     78          /* 
     79           The following local Varables are only set in MAC_SrcMatchEnable()  
     80           They are read only to the rest of the module.
     81           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     82          uint8 macSrcMatchMaxNumEntries = 0;   
   \                     macSrcMatchMaxNumEntries:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
     83          uint8 macSrcMatchAddrMode = SADDR_MODE_SHORT;  
   \                     macSrcMatchAddrMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for macSrcMatchAddrMode>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     84          bool macSrcMatchIsAckAllPending = FALSE;
   \                     macSrcMatchIsAckAllPending:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     85          
     86          /* ------------------------------------------------------------------------------------------------
     87           *                                         Local Functions
     88           * ------------------------------------------------------------------------------------------------
     89           */
     90          static uint8 macSrcMatchFindEmptyEntry( void );
     91          static uint8 macSrcMatchCheckSrcAddr ( sAddr_t *addr, uint16 panID  );
     92          static void macSrcMatchSetPendEnBit( uint8 index );
     93          static void macSrcMatchSetEnableBit( uint8 index, bool option );
     94          static bool macSrcMatchCheckEnableBit( uint8 index );
     95          static uint24 macSrcMatchGetEnableBit( void );
     96          static uint24 macSrcMatchGetPendEnBit( void );
     97          
     98          
     99          
    100          /*********************************************************************
    101           * @fn          MAC_SrcMatchEnable
    102           *
    103           * @brief      Enabled AUTOPEND and source address matching. If number of source
    104           *             address table entries asked for is more than the hardware
    105           *             supports. It will allocate maximum number of entries and return 
    106           *             MAC_INVALID_PARAMETER. This function shall be not be called from 
    107           *             ISR. It is not thread safe.
    108           *
    109           * @param      addressType - address type that the application uses
    110           *                           SADDR_MODE_SHORT or SADDR_MODE_EXT
    111           * @param      num - number of source address table entries to be used
    112           *
    113           * @return     MAC_SUCCESS or MAC_INVALID_PARAMETER
    114           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    115          uint8 MAC_SrcMatchEnable ( uint8 addrType, uint8 num  )
   \                     MAC_SrcMatchEnable:
    116          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   F8           MOV     R0,A
    117            uint8 rtn;
    118            uint8 maxNum;
    119              
    120            /* Verify the address type */
    121            if( addrType != SADDR_MODE_SHORT && addrType != SADDR_MODE_EXT )
   \   000006   7402         MOV     A,#0x2
   \   000008   68           XRL     A,R0
   \   000009   6009         JZ      ??MAC_SrcMatchEnable_0
   \   00000B   7403         MOV     A,#0x3
   \   00000D   68           XRL     A,R0
   \   00000E   6004         JZ      ??MAC_SrcMatchEnable_0
    122            {
    123              return MAC_INVALID_PARAMETER;
   \   000010   79E8         MOV     R1,#-0x18
   \   000012   8041         SJMP    ??MAC_SrcMatchEnable_1
    124            }
    125            
    126            maxNum = ( addrType == SADDR_MODE_SHORT ) ? 
    127                     MAC_SRCMATCH_SHORT_MAX_NUM_ENTRIES : MAC_SRCMATCH_EXT_MAX_NUM_ENTRIES;
   \                     ??MAC_SrcMatchEnable_0:
   \   000014   7402         MOV     A,#0x2
   \   000016   68           XRL     A,R0
   \   000017   7004         JNZ     ??MAC_SrcMatchEnable_2
   \   000019   7B18         MOV     R3,#0x18
   \   00001B   8002         SJMP    ??MAC_SrcMatchEnable_3
   \                     ??MAC_SrcMatchEnable_2:
   \   00001D   7B0C         MOV     R3,#0xc
    128                     
    129            if( num > maxNum )
   \                     ??MAC_SrcMatchEnable_3:
   \   00001F   EB           MOV     A,R3
   \   000020   C3           CLR     C
   \   000021   9A           SUBB    A,R2
   \   000022   5006         JNC     ??MAC_SrcMatchEnable_4
    130            {
    131              rtn = MAC_INVALID_PARAMETER;
   \   000024   79E8         MOV     R1,#-0x18
    132              num = maxNum;
   \   000026   EB           MOV     A,R3
   \   000027   FA           MOV     R2,A
   \   000028   8002         SJMP    ??MAC_SrcMatchEnable_5
    133            }
    134            else
    135            {
    136              rtn = MAC_SUCCESS;
   \                     ??MAC_SrcMatchEnable_4:
   \   00002A   7900         MOV     R1,#0x0
    137            }
    138              
    139            /* Turn on Frame Filter (TIMAC enables frame filter by default), TBD */
    140            MAC_RADIO_TURN_ON_RX_FRAME_FILTERING();
   \                     ??MAC_SrcMatchEnable_5:
   \   00002C   906180       MOV     DPTR,#0x6180
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   D2E0         SETB    0xE0 /* A   */.0
   \   000032   F0           MOVX    @DPTR,A
    141            
    142            /* Turn on Auto ACK (TIMAC turn on Auto ACK by default), TBD */
    143            MAC_RADIO_TURN_ON_AUTO_ACK();
   \   000033   906189       MOV     DPTR,#0x6189
   \   000036   E0           MOVX    A,@DPTR
   \   000037   D2E5         SETB    0xE0 /* A   */.5
   \   000039   F0           MOVX    @DPTR,A
    144            
    145            /* Turn on Autopend: set SRCMATCH.AUTOPEND and SRCMATCH.SRC_MATCH_EN */
    146            MAC_RADIO_TURN_ON_SRC_MATCH();
   \   00003A   906182       MOV     DPTR,#0x6182
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   D2E0         SETB    0xE0 /* A   */.0
   \   000040   F0           MOVX    @DPTR,A
    147           
    148            /* Set SRCMATCH.AUTOPEND */
    149            MAC_RADIO_TURN_ON_AUTOPEND();
   \   000041   E0           MOVX    A,@DPTR
   \   000042   D2E1         SETB    0xE0 /* A   */.1
   \   000044   F0           MOVX    @DPTR,A
    150            
    151            /* Configure all the globals */
    152            macSrcMatchIsEnabled = TRUE;
   \   000045   90....       MOV     DPTR,#macSrcMatchIsEnabled
   \   000048   7401         MOV     A,#0x1
   \   00004A   F0           MOVX    @DPTR,A
    153            macSrcMatchMaxNumEntries = num;
   \   00004B   EA           MOV     A,R2
   \   00004C   90....       MOV     DPTR,#macSrcMatchMaxNumEntries
   \   00004F   F0           MOVX    @DPTR,A
    154            macSrcMatchAddrMode = addrType;           
   \   000050   E8           MOV     A,R0
   \   000051   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   000054   F0           MOVX    @DPTR,A
    155          
    156            return rtn;
   \                     ??MAC_SrcMatchEnable_1:
   \   000055   D083         POP     DPH
   \   000057   D082         POP     DPL
   \   000059   02....       LJMP    ?BRET
    157          }
    158          
    159          /*********************************************************************
    160           * @fn          MAC_SrcMatchAddEntry
    161           *
    162           * @brief       Add a short or extended address to source address table. This 
    163           *              function shall be not be called from ISR. It is not thread safe.
    164           *
    165           * @param       addr - a pointer to sAddr_t which contains addrMode 
    166           *                     and a union of a short 16-bit MAC address or an extended 
    167           *                     64-bit MAC address to be added to the source address table. 
    168           * @param       panID - the device PAN ID. It is only used when the addr is 
    169           *                      using short address 
    170          
    171           * @return      MAC_SUCCESS or MAC_NO_RESOURCES (source address table full) 
    172           *              or MAC_DUPLICATED_ENTRY (the entry added is duplicated),
    173           *              or MAC_INVALID_PARAMETER if the input parameters are invalid.
    174           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    175          uint8 MAC_SrcMatchAddEntry ( sAddr_t *addr, uint16 panID )
   \                     MAC_SrcMatchAddEntry:
    176          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
    177            uint8 index;
    178            uint8 entry[MAC_SRCMATCH_SHORT_ENTRY_SIZE];
    179            
    180            /* Check if the input parameters are valid */
    181            if ( addr == NULL || addr->addrMode != macSrcMatchAddrMode )
   \   000012   EA           MOV     A,R2
   \   000013   45..         ORL     A,?V0 + 1
   \   000015   6015         JZ      ??MAC_SrcMatchAddEntry_0
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   A3           INC     DPTR
   \   00001E   A3           INC     DPTR
   \   00001F   A3           INC     DPTR
   \   000020   A3           INC     DPTR
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F8           MOV     R0,A
   \   000025   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   000028   E0           MOVX    A,@DPTR
   \   000029   68           XRL     A,R0
   \   00002A   6005         JZ      ??MAC_SrcMatchAddEntry_1
    182            {
    183              return MAC_INVALID_PARAMETER;  
   \                     ??MAC_SrcMatchAddEntry_0:
   \   00002C   79E8         MOV     R1,#-0x18
   \   00002E   02....       LJMP    ??MAC_SrcMatchAddEntry_2 & 0xFFFF
    184            }
    185            
    186            /* Check if the entry already exists. Do not add duplicated entry */
    187            if ( macSrcMatchCheckSrcAddr( addr, panID ) != MAC_SRCMATCH_INVALID_INDEX )
   \                     ??MAC_SrcMatchAddEntry_1:
   \   000031                ; Setup parameters for call to function macSrcMatchCheckSrcAddr
   \   000031   12....       LCALL   ??macSrcMatchCheckSrcAddr?relay
   \   000034   E9           MOV     A,R1
   \   000035   F4           CPL     A
   \   000036   6005         JZ      ??MAC_SrcMatchAddEntry_3
    188            {
    189              return MAC_DUPLICATED_ENTRY; 
   \   000038   791E         MOV     R1,#0x1e
   \   00003A   02....       LJMP    ??MAC_SrcMatchAddEntry_2 & 0xFFFF
    190            }
    191            
    192            /* If not duplicated, write to the radio RAM and enable the control bit */
    193            
    194            /* Find the first empty entry */
    195            index = macSrcMatchFindEmptyEntry();
   \                     ??MAC_SrcMatchAddEntry_3:
   \   00003D                ; Setup parameters for call to function macSrcMatchFindEmptyEntry
   \   00003D   12....       LCALL   ??macSrcMatchFindEmptyEntry?relay
   \   000040   E9           MOV     A,R1
   \   000041   F5..         MOV     ?V0 + 2,A
    196            if ( index == macSrcMatchMaxNumEntries )
   \   000043   90....       MOV     DPTR,#macSrcMatchMaxNumEntries
   \   000046   E0           MOVX    A,@DPTR
   \   000047   65..         XRL     A,?V0 + 2
   \   000049   7004         JNZ     ??MAC_SrcMatchAddEntry_4
    197            {
    198              return MAC_NO_RESOURCES;   /* Table is full */
   \   00004B   791A         MOV     R1,#0x1a
   \   00004D   807C         SJMP    ??MAC_SrcMatchAddEntry_2
    199            }
    200            
    201            if ( macSrcMatchAddrMode == SADDR_MODE_SHORT )
   \                     ??MAC_SrcMatchAddEntry_4:
   \   00004F   8982         MOV     DPL,R1
   \   000051   8582..       MOV     ?V0 + 4,DPL
   \   000054   75..00       MOV     ?V0 + 5,#0x0
   \   000057   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   6402         XRL     A,#0x2
   \   00005D   7046         JNZ     ??MAC_SrcMatchAddEntry_5
    202            {
    203              /* Write the PanID and short address */
    204              entry[0] = LO_UINT16( panID );  /* Little Endian for the radio RAM */
   \   00005F   EE           MOV     A,R6
   \   000060   85..82       MOV     DPL,?XSP + 0
   \   000063   85..83       MOV     DPH,?XSP + 1
   \   000066   F0           MOVX    @DPTR,A
    205              entry[1] = HI_UINT16( panID );
   \   000067   EF           MOV     A,R7
   \   000068   C0E0         PUSH    A
   \   00006A   7401         MOV     A,#0x1
   \   00006C   12....       LCALL   ?XSTACK_DISP0_8
   \   00006F   D0E0         POP     A
   \   000071   F0           MOVX    @DPTR,A
    206              entry[2] = LO_UINT16( addr->addr.shortAddr );
   \   000072   85..82       MOV     DPL,?V0 + 0
   \   000075   85..83       MOV     DPH,?V0 + 1
   \   000078   E0           MOVX    A,@DPTR
   \   000079   C0E0         PUSH    A
   \   00007B   7402         MOV     A,#0x2
   \   00007D   12....       LCALL   ?XSTACK_DISP0_8
   \   000080   D0E0         POP     A
   \   000082   F0           MOVX    @DPTR,A
    207              entry[3] = HI_UINT16( addr->addr.shortAddr );
   \   000083   85..82       MOV     DPL,?V0 + 0
   \   000086   85..83       MOV     DPH,?V0 + 1
   \   000089   A3           INC     DPTR
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   C0E0         PUSH    A
   \   00008D   7403         MOV     A,#0x3
   \   00008F   12....       LCALL   ?XSTACK_DISP0_8
   \   000092   D0E0         POP     A
   \   000094   F0           MOVX    @DPTR,A
    208              MAC_RADIO_SRC_MATCH_TABLE_WRITE( ( index * MAC_SRCMATCH_SHORT_ENTRY_SIZE ), 
    209                             entry, MAC_SRCMATCH_SHORT_ENTRY_SIZE );
   \   000095                ; Setup parameters for call to function macMemWriteRam
   \   000095   7904         MOV     R1,#0x4
   \   000097   85..82       MOV     DPL,?XSP + 0
   \   00009A   85..83       MOV     DPH,?XSP + 1
   \   00009D   AC82         MOV     R4,DPL
   \   00009F   AD83         MOV     R5,DPH
   \   0000A1   7402         MOV     A,#0x2
   \   0000A3   8008         SJMP    ??MAC_SrcMatchAddEntry_6
    210            }
    211            else
    212            {
    213              /* Write the extended address */
    214              MAC_RADIO_SRC_MATCH_TABLE_WRITE( ( index * MAC_SRCMATCH_EXT_ENTRY_SIZE ), 
    215                             addr->addr.extAddr, MAC_SRCMATCH_EXT_ENTRY_SIZE ); 
   \                     ??MAC_SrcMatchAddEntry_5:
   \   0000A5                ; Setup parameters for call to function macMemWriteRam
   \   0000A5   7908         MOV     R1,#0x8
   \   0000A7   AC..         MOV     R4,?V0 + 0
   \   0000A9   AD..         MOV     R5,?V0 + 1
   \   0000AB   7403         MOV     A,#0x3
   \                     ??MAC_SrcMatchAddEntry_6:
   \   0000AD   78..         MOV     R0,#?V0 + 4
   \   0000AF   12....       LCALL   ?S_SHL
   \   0000B2   25..         ADD     A,?V0 + 4
   \   0000B4   FA           MOV     R2,A
   \   0000B5   7461         MOV     A,#0x61
   \   0000B7   35..         ADDC    A,?V0 + 5
   \   0000B9   FB           MOV     R3,A
   \   0000BA   12....       LCALL   ??macMemWriteRam?relay
    216            }
    217            
    218            /* Set the Autopend enable bits */
    219            macSrcMatchSetPendEnBit( index );
   \   0000BD                ; Setup parameters for call to function macSrcMatchSetPendEnBit
   \   0000BD   A9..         MOV     R1,?V0 + 2
   \   0000BF   12....       LCALL   ??macSrcMatchSetPendEnBit?relay
    220            
    221            /* Set the Src Match enable bits */
    222            macSrcMatchSetEnableBit( index, TRUE );
   \   0000C2                ; Setup parameters for call to function macSrcMatchSetEnableBit
   \   0000C2   7A01         MOV     R2,#0x1
   \   0000C4   A9..         MOV     R1,?V0 + 2
   \   0000C6   12....       LCALL   ??macSrcMatchSetEnableBit?relay
    223            
    224            return MAC_SUCCESS;
   \   0000C9   7900         MOV     R1,#0x0
   \                     ??MAC_SrcMatchAddEntry_2:
   \   0000CB   7404         MOV     A,#0x4
   \   0000CD   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000D0   7F06         MOV     R7,#0x6
   \   0000D2   02....       LJMP    ?BANKED_LEAVE_XDATA
    225            
    226          }
    227          
    228          /*********************************************************************
    229           * @fn         MAC_SrcMatchDeleteEntry
    230           *
    231           * @brief      Delete a short or extended address from source address table. 
    232           *             This function shall be not be called from ISR. It is not thread safe.
    233           *
    234           * @param      addr - a pointer to sAddr_t which contains addrMode 
    235           *                    and a union of a short 16-bit MAC address or an extended 
    236           *                    64-bit MAC address to be deleted from the source address table. 
    237           * @param      panID - the device PAN ID. It is only used when the addr is 
    238           *                     using short address  
    239           *
    240           * @return     MAC_SUCCESS or MAC_INVALID_PARAMETER (address to be deleted 
    241           *                  cannot be found in the source address table).
    242           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    243          uint8 MAC_SrcMatchDeleteEntry ( sAddr_t *addr, uint16 panID  )
   \                     MAC_SrcMatchDeleteEntry:
    244          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    245            uint8 index;
    246            
    247            if ( addr == NULL || addr->addrMode != macSrcMatchAddrMode )
   \   000004   EA           MOV     A,R2
   \   000005   4B           ORL     A,R3
   \   000006   6015         JZ      ??MAC_SrcMatchDeleteEntry_0
   \   000008   8A82         MOV     DPL,R2
   \   00000A   8B83         MOV     DPH,R3
   \   00000C   A3           INC     DPTR
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F8           MOV     R0,A
   \   000016   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   68           XRL     A,R0
   \   00001B   6004         JZ      ??MAC_SrcMatchDeleteEntry_1
    248            {
    249              return MAC_INVALID_PARAMETER;  
   \                     ??MAC_SrcMatchDeleteEntry_0:
   \   00001D   79E8         MOV     R1,#-0x18
   \   00001F   800F         SJMP    ??MAC_SrcMatchDeleteEntry_2
    250            }
    251            
    252            /* Look up the source address table and find the entry. */
    253            index = macSrcMatchCheckSrcAddr( addr, panID );
   \                     ??MAC_SrcMatchDeleteEntry_1:
   \   000021                ; Setup parameters for call to function macSrcMatchCheckSrcAddr
   \   000021   12....       LCALL   ??macSrcMatchCheckSrcAddr?relay
    254          
    255            if( index == MAC_SRCMATCH_INVALID_INDEX )
   \   000024   74FF         MOV     A,#-0x1
   \   000026   69           XRL     A,R1
   \   000027   60F4         JZ      ??MAC_SrcMatchDeleteEntry_0
    256            {
    257              return MAC_INVALID_PARAMETER; 
    258            }
    259            
    260            /* Clear Src Match enable bits */
    261            macSrcMatchSetEnableBit( index, FALSE );
   \   000029                ; Setup parameters for call to function macSrcMatchSetEnableBit
   \   000029   7A00         MOV     R2,#0x0
   \   00002B   12....       LCALL   ??macSrcMatchSetEnableBit?relay
    262          
    263            return MAC_SUCCESS;
   \   00002E   7900         MOV     R1,#0x0
   \                     ??MAC_SrcMatchDeleteEntry_2:
   \   000030   D083         POP     DPH
   \   000032   D082         POP     DPL
   \   000034   02....       LJMP    ?BRET
    264          }
    265                            
    266          
    267          /*********************************************************************
    268           * @fn          MAC_SrcMatchAckAllPending
    269           *
    270           * @brief       Enabled/disable acknowledging all packets with pending bit set
    271           *              The application normally enables it when adding new entries to 
    272           *              the source address table fails due to the table is full, or 
    273           *              disables it when more entries are deleted and the table has
    274           *              empty slots.
    275           *
    276           * @param       option - TRUE (acknowledging all packets with pending field set)
    277           *                       FALSE (acknowledging all packets with pending field cleared) 
    278           *
    279           * @return      none
    280           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    281          void MAC_SrcMatchAckAllPending ( uint8 option  ) 
   \                     MAC_SrcMatchAckAllPending:
    282          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    283            if( option == TRUE )
   \   000004   7401         MOV     A,#0x1
   \   000006   69           XRL     A,R1
   \   000007   90....       MOV     DPTR,#macSrcMatchIsAckAllPending
   \   00000A   700B         JNZ     ??MAC_SrcMatchAckAllPending_0
    284            {
    285              macSrcMatchIsAckAllPending = TRUE;
   \   00000C   7401         MOV     A,#0x1
   \   00000E   F0           MOVX    @DPTR,A
    286              
    287              /* Set the PENDING_OR register */
    288              MAC_RADIO_TURN_ON_PENDING_OR();
   \   00000F   90618A       MOV     DPTR,#0x618a
   \   000012   E0           MOVX    A,@DPTR
   \   000013   D2E2         SETB    0xE0 /* A   */.2
   \   000015   8008         SJMP    ??MAC_SrcMatchAckAllPending_1
    289            }
    290            else
    291            {
    292              macSrcMatchIsAckAllPending = FALSE;
   \                     ??MAC_SrcMatchAckAllPending_0:
   \   000017   E4           CLR     A
   \   000018   F0           MOVX    @DPTR,A
    293              
    294              /* Clear the PENDING_OR register */
    295              MAC_RADIO_TURN_OFF_PENDING_OR();
   \   000019   90618A       MOV     DPTR,#0x618a
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   C2E2         CLR     0xE0 /* A   */.2
   \                     ??MAC_SrcMatchAckAllPending_1:
   \   00001F   F0           MOVX    @DPTR,A
    296            }
    297          }
   \   000020   D083         POP     DPH
   \   000022   D082         POP     DPL
   \   000024   02....       LJMP    ?BRET
    298          
    299          /*********************************************************************
    300           * @fn          MAC_SrcMatchCheckAllPending
    301           *
    302           * @brief       Check if acknowledging all packets with pending bit set
    303           *              is enabled. 
    304           *
    305           * @param       none 
    306           *
    307           * @return      MAC_AUTOACK_PENDING_ALL_ON or MAC_AUTOACK_PENDING_ALL_OFF
    308           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    309          uint8 MAC_SrcMatchCheckAllPending ( void )
   \                     MAC_SrcMatchCheckAllPending:
    310          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    311            if( macSrcMatchIsAckAllPending == TRUE )
   \   000004   90....       MOV     DPTR,#macSrcMatchIsAckAllPending
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   7004         JNZ     ??MAC_SrcMatchCheckAllPending_0
    312            {
    313              return MAC_AUTOACK_PENDING_ALL_ON; 
   \   00000C   79FE         MOV     R1,#-0x2
   \   00000E   8002         SJMP    ??MAC_SrcMatchCheckAllPending_1
    314            }
    315            
    316            return MAC_AUTOACK_PENDING_ALL_OFF;
   \                     ??MAC_SrcMatchCheckAllPending_0:
   \   000010   79FF         MOV     R1,#-0x1
   \                     ??MAC_SrcMatchCheckAllPending_1:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET
    317          }
    318          
    319          /*********************************************************************
    320           * @fn          MAC_SrcMatchCheckResult
    321           *
    322           * @brief       Check the result of source matching
    323           *
    324           * @param       index - index of the entry in the source address table
    325           *
    326           * @return      TRUE or FALSE
    327           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    328          bool MAC_SrcMatchCheckResult( void )
   \                     MAC_SrcMatchCheckResult:
    329          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    330            uint8 resIndex;
    331            
    332            if ( macSrcMatchIsAckAllPending )
   \   000004   90....       MOV     DPTR,#macSrcMatchIsAckAllPending
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6004         JZ      ??MAC_SrcMatchCheckResult_0
    333            {
    334              return (TRUE);
   \   00000A   7901         MOV     R1,#0x1
   \   00000C   8009         SJMP    ??MAC_SrcMatchCheckResult_1
    335            }
    336            
    337            MAC_RADIO_SRC_MATCH_RESINDEX( resIndex );
   \                     ??MAC_SrcMatchCheckResult_0:
   \   00000E   906163       MOV     DPTR,#0x6163
   \   000011   E0           MOVX    A,@DPTR
   \   000012   F8           MOV     R0,A
    338            
    339            return ( resIndex & AUTOPEND_RES );
   \   000013   7440         MOV     A,#0x40
   \   000015   58           ANL     A,R0
   \   000016   F9           MOV     R1,A
   \                     ??MAC_SrcMatchCheckResult_1:
   \   000017   D083         POP     DPH
   \   000019   D082         POP     DPL
   \   00001B   02....       LJMP    ?BRET
    340          }
    341          
    342          /*********************************************************************
    343           * @fn          macSrcMatchFindEmptyEntry
    344           *
    345           * @brief       return index of the first empty entry found
    346           *
    347           * @param       none
    348           *
    349           * @return      uint8 - return index of the first empty entry found
    350           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    351          static uint8 macSrcMatchFindEmptyEntry( void )
   \                     macSrcMatchFindEmptyEntry:
    352          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    353            uint8  index;
    354            uint24 enable;
    355               
    356            enable = MAC_RADIO_SRC_MATCH_GET_EN();
   \   00000A                ; Setup parameters for call to function macSrcMatchGetEnableBit
   \   00000A   12....       LCALL   ??macSrcMatchGetEnableBit?relay
   \   00000D   85..82       MOV     DPL,?XSP + 0
   \   000010   85..83       MOV     DPH,?XSP + 1
   \   000013   12....       LCALL   ?XSTORE_R2345
    357                  
    358            if( macSrcMatchAddrMode == SADDR_MODE_SHORT )
   \   000016   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   6402         XRL     A,#0x2
   \   00001C   7900         MOV     R1,#0x0
   \   00001E   7041         JNZ     ??macSrcMatchFindEmptyEntry_0
    359            {
    360              for( index = 0; index < macSrcMatchMaxNumEntries; index++ )
   \   000020   8001         SJMP    ??macSrcMatchFindEmptyEntry_1
   \                     ??macSrcMatchFindEmptyEntry_2:
   \   000022   09           INC     R1
   \                     ??macSrcMatchFindEmptyEntry_1:
   \   000023   90....       MOV     DPTR,#macSrcMatchMaxNumEntries
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F8           MOV     R0,A
   \   000028   E9           MOV     A,R1
   \   000029   C3           CLR     C
   \   00002A   98           SUBB    A,R0
   \   00002B   502A         JNC     ??macSrcMatchFindEmptyEntry_3
    361              {  
    362                if( ( enable & ( 0x01 << index ) ) == 0 )
   \   00002D   85..82       MOV     DPL,?XSP + 0
   \   000030   85..83       MOV     DPH,?XSP + 1
   \   000033   75..01       MOV     ?V0 + 0,#0x1
   \   000036   75..00       MOV     ?V0 + 1,#0x0
   \   000039   E9           MOV     A,R1
   \   00003A   78..         MOV     R0,#?V0 + 0
   \   00003C   12....       LCALL   ?S_SHL
   \   00003F   E5..         MOV     A,?V0 + 1
   \   000041   33           RLC     A
   \   000042   95E0         SUBB    A,0xE0 /* A   */
   \   000044   F5..         MOV     ?V0 + 2,A
   \   000046   F5..         MOV     ?V0 + 3,A
   \   000048   78..         MOV     R0,#?V0 + 0
   \   00004A   12....       LCALL   ?L_AND_X
   \   00004D   E5..         MOV     A,?V0 + 0
   \   00004F   45..         ORL     A,?V0 + 1
   \   000051   45..         ORL     A,?V0 + 2
   \   000053   45..         ORL     A,?V0 + 3
   \   000055   70CB         JNZ     ??macSrcMatchFindEmptyEntry_2
    363                {
    364                  return index;
   \                     ??macSrcMatchFindEmptyEntry_3:
   \   000057   7404         MOV     A,#0x4
   \   000059   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005C   7F04         MOV     R7,#0x4
   \   00005E   02....       LJMP    ?BANKED_LEAVE_XDATA
    365                }
    366              }
    367            }
    368            else
    369            {
    370              for( index = 0; index < macSrcMatchMaxNumEntries; index++ )
   \                     ??macSrcMatchFindEmptyEntry_0:
   \   000061   90....       MOV     DPTR,#macSrcMatchMaxNumEntries
   \   000064   E0           MOVX    A,@DPTR
   \   000065   F8           MOV     R0,A
   \   000066   E9           MOV     A,R1
   \   000067   C3           CLR     C
   \   000068   98           SUBB    A,R0
   \   000069   50EC         JNC     ??macSrcMatchFindEmptyEntry_3
    371              {  
    372                if( ( enable & ( 0x01 << ( index * 2 ) ) ) == 0 )
   \   00006B   85..82       MOV     DPL,?XSP + 0
   \   00006E   85..83       MOV     DPH,?XSP + 1
   \   000071   75..01       MOV     ?V0 + 0,#0x1
   \   000074   75..00       MOV     ?V0 + 1,#0x0
   \   000077   E9           MOV     A,R1
   \   000078   C3           CLR     C
   \   000079   33           RLC     A
   \   00007A   78..         MOV     R0,#?V0 + 0
   \   00007C   12....       LCALL   ?S_SHL
   \   00007F   E5..         MOV     A,?V0 + 1
   \   000081   33           RLC     A
   \   000082   95E0         SUBB    A,0xE0 /* A   */
   \   000084   F5..         MOV     ?V0 + 2,A
   \   000086   F5..         MOV     ?V0 + 3,A
   \   000088   78..         MOV     R0,#?V0 + 0
   \   00008A   12....       LCALL   ?L_AND_X
   \   00008D   E5..         MOV     A,?V0 + 0
   \   00008F   45..         ORL     A,?V0 + 1
   \   000091   45..         ORL     A,?V0 + 2
   \   000093   45..         ORL     A,?V0 + 3
   \   000095   60C0         JZ      ??macSrcMatchFindEmptyEntry_3
    373                {
    374                  return index;
    375                }
    376              }
   \   000097   09           INC     R1
   \   000098   80C7         SJMP    ??macSrcMatchFindEmptyEntry_0
    377            }
    378            
    379            /* 
    380             The value of index shall be macSrcMatchMaxNumEntries when it executes
    381             here. The table is full.
    382            */
    383            return index;
    384          }
    385          
    386          /*********************************************************************
    387           * @fn         macSrcMatchCheckSrcAddr
    388           *
    389           * @brief      Check if a short or extended address is in the source address table.
    390           *             This function shall not be called from ISR. It is not thread safe.
    391           *
    392           * @param      addr - a pointer to sAddr_t which contains addrMode 
    393           *                    and a union of a short 16-bit MAC address or an extended 
    394           *                    64-bit MAC address to be checked in the source address table. 
    395           * @param      panID - the device PAN ID. It is only used when the addr is 
    396           *                     using short address 
    397          
    398           * @return     uint8 - index of the entry in the table. Return 
    399           *                     MAC_SRCMATCH_INVALID_INDEX (0xFF) if address not found.
    400           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    401          static uint8 macSrcMatchCheckSrcAddr ( sAddr_t *addr, uint16 panID  )
   \                     macSrcMatchCheckSrcAddr:
    402          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV     A,#-0xc
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    403            
    404            uint8 index;     
    405            uint8 *pAddr;
    406            uint8 entrySize;
    407            uint8 entry[MAC_SRCMATCH_SHORT_ENTRY_SIZE];  
    408            uint8 ramEntry[MAC_SRCMATCH_EXT_ENTRY_SIZE];
    409                
    410            /*
    411             Currently, shadow memory is not supported to optimize SPI traffic.
    412            */
    413            
    414            if( macSrcMatchAddrMode == SADDR_MODE_SHORT )
   \   00000A   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6402         XRL     A,#0x2
   \   000010   7042         JNZ     ??macSrcMatchCheckSrcAddr_0
    415            {
    416              entry[0] = LO_UINT16( panID );  /* Little Endian for the radio RAM */
   \   000012   EC           MOV     A,R4
   \   000013   85..82       MOV     DPL,?XSP + 0
   \   000016   85..83       MOV     DPH,?XSP + 1
   \   000019   F0           MOVX    @DPTR,A
    417              entry[1] = HI_UINT16( panID );
   \   00001A   ED           MOV     A,R5
   \   00001B   C0E0         PUSH    A
   \   00001D   7401         MOV     A,#0x1
   \   00001F   12....       LCALL   ?XSTACK_DISP0_8
   \   000022   D0E0         POP     A
   \   000024   F0           MOVX    @DPTR,A
    418              entry[2] = LO_UINT16( addr->addr.shortAddr );
   \   000025   8A82         MOV     DPL,R2
   \   000027   8B83         MOV     DPH,R3
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   C0E0         PUSH    A
   \   00002C   7402         MOV     A,#0x2
   \   00002E   12....       LCALL   ?XSTACK_DISP0_8
   \   000031   D0E0         POP     A
   \   000033   F0           MOVX    @DPTR,A
    419              entry[3] = HI_UINT16( addr->addr.shortAddr );
   \   000034   8A82         MOV     DPL,R2
   \   000036   8B83         MOV     DPH,R3
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   C0E0         PUSH    A
   \   00003C   7403         MOV     A,#0x3
   \   00003E   12....       LCALL   ?XSTACK_DISP0_8
   \   000041   D0E0         POP     A
   \   000043   F0           MOVX    @DPTR,A
    420              pAddr = entry;
   \   000044   85..82       MOV     DPL,?XSP + 0
   \   000047   85..83       MOV     DPH,?XSP + 1
   \   00004A   8582..       MOV     ?V0 + 4,DPL
   \   00004D   8583..       MOV     ?V0 + 5,DPH
    421              entrySize = MAC_SRCMATCH_SHORT_ENTRY_SIZE;
   \   000050   7F04         MOV     R7,#0x4
   \   000052   8006         SJMP    ??macSrcMatchCheckSrcAddr_1
    422            }
    423            else
    424            {
    425              pAddr = addr->addr.extAddr;
   \                     ??macSrcMatchCheckSrcAddr_0:
   \   000054   8A..         MOV     ?V0 + 4,R2
   \   000056   8B..         MOV     ?V0 + 5,R3
    426              entrySize = MAC_SRCMATCH_EXT_ENTRY_SIZE;
   \   000058   7F08         MOV     R7,#0x8
    427            }
    428            
    429            for( index = 0; index < macSrcMatchMaxNumEntries; index++ )
   \                     ??macSrcMatchCheckSrcAddr_1:
   \   00005A   7E00         MOV     R6,#0x0
   \   00005C   8001         SJMP    ??macSrcMatchCheckSrcAddr_2
   \                     ??macSrcMatchCheckSrcAddr_3:
   \   00005E   0E           INC     R6
   \                     ??macSrcMatchCheckSrcAddr_2:
   \   00005F   90....       MOV     DPTR,#macSrcMatchMaxNumEntries
   \   000062   E0           MOVX    A,@DPTR
   \   000063   F8           MOV     R0,A
   \   000064   EE           MOV     A,R6
   \   000065   C3           CLR     C
   \   000066   98           SUBB    A,R0
   \   000067   505C         JNC     ??macSrcMatchCheckSrcAddr_4
    430            {
    431              /* Check if the entry is enabled */
    432              if( macSrcMatchCheckEnableBit( index ) == FALSE )
   \   000069                ; Setup parameters for call to function macSrcMatchCheckEnableBit
   \   000069   EE           MOV     A,R6
   \   00006A   F9           MOV     R1,A
   \   00006B   12....       LCALL   ??macSrcMatchCheckEnableBit?relay
   \   00006E   E9           MOV     A,R1
   \   00006F   60ED         JZ      ??macSrcMatchCheckSrcAddr_3
    433              {
    434                continue; 
    435              }
    436                
    437              /* Compare the short address and pan ID */
    438              MAC_RADIO_SRC_MATCH_TABLE_READ( ( index * entrySize ), ramEntry, entrySize );
   \   000071                ; Setup parameters for call to function macMemReadRam
   \   000071   EF           MOV     A,R7
   \   000072   F9           MOV     R1,A
   \   000073   7404         MOV     A,#0x4
   \   000075   12....       LCALL   ?XSTACK_DISP0_8
   \   000078   AC82         MOV     R4,DPL
   \   00007A   AD83         MOV     R5,DPH
   \   00007C   EE           MOV     A,R6
   \   00007D   89F0         MOV     B,R1
   \   00007F   A4           MUL     AB
   \   000080   FA           MOV     R2,A
   \   000081   A8F0         MOV     R0,B
   \   000083   E4           CLR     A
   \   000084   28           ADD     A,R0
   \   000085   FB           MOV     R3,A
   \   000086   7461         MOV     A,#0x61
   \   000088   3B           ADDC    A,R3
   \   000089   FB           MOV     R3,A
   \   00008A   12....       LCALL   ??macMemReadRam?relay
    439               
    440              if( osal_memcmp( pAddr, ramEntry, entrySize ) == TRUE )
   \   00008D                ; Setup parameters for call to function osal_memcmp
   \   00008D   7404         MOV     A,#0x4
   \   00008F   12....       LCALL   ?XSTACK_DISP0_8
   \   000092   A982         MOV     R1,DPL
   \   000094   AA83         MOV     R2,DPH
   \   000096   89..         MOV     ?V0 + 0,R1
   \   000098   8A..         MOV     ?V0 + 1,R2
   \   00009A   75..00       MOV     ?V0 + 2,#0x0
   \   00009D   78..         MOV     R0,#?V0 + 0
   \   00009F   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000A2   8F..         MOV     ?V0 + 0,R7
   \   0000A4   AC..         MOV     R4,?V0 + 0
   \   0000A6   7D00         MOV     R5,#0x0
   \   0000A8   85..82       MOV     DPL,?V0 + 4
   \   0000AB   85..83       MOV     DPH,?V0 + 5
   \   0000AE   A982         MOV     R1,DPL
   \   0000B0   AA83         MOV     R2,DPH
   \   0000B2   7B00         MOV     R3,#0x0
   \   0000B4   12....       LCALL   ??osal_memcmp?relay
   \   0000B7   7403         MOV     A,#0x3
   \   0000B9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000BC   E9           MOV     A,R1
   \   0000BD   6401         XRL     A,#0x1
   \   0000BF   709D         JNZ     ??macSrcMatchCheckSrcAddr_3
    441              {
    442                /* Match found */
    443                return index;
   \   0000C1   EE           MOV     A,R6
   \   0000C2   F9           MOV     R1,A
   \   0000C3   8002         SJMP    ??macSrcMatchCheckSrcAddr_5
    444              }
    445            }
    446            
    447            return MAC_SRCMATCH_INVALID_INDEX;
   \                     ??macSrcMatchCheckSrcAddr_4:
   \   0000C5   79FF         MOV     R1,#-0x1
   \                     ??macSrcMatchCheckSrcAddr_5:
   \   0000C7   740C         MOV     A,#0xc
   \   0000C9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000CC   7F06         MOV     R7,#0x6
   \   0000CE   02....       LJMP    ?BANKED_LEAVE_XDATA
    448          }
    449          
    450          
    451          /*********************************************************************
    452           * @fn          macSrcMatchSetPendEnBit
    453           *
    454           * @brief       Set the enable bit in the source address table
    455           *
    456           * @param       index - index of the entry in the source address table
    457           *
    458           * @return      none
    459           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    460          static void macSrcMatchSetPendEnBit( uint8 index )
   \                     macSrcMatchSetPendEnBit:
    461          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    462            uint24 enable;
    463            uint8 buf[MAC_SRCMATCH_ENABLE_BITMAP_LEN];
    464                 
    465            enable = MAC_RADIO_SRC_MATCH_GET_PENDEN(); 
   \   00000C                ; Setup parameters for call to function macSrcMatchGetPendEnBit
   \   00000C   12....       LCALL   ??macSrcMatchGetPendEnBit?relay
   \   00000F   8A..         MOV     ?V0 + 0,R2
   \   000011   8B..         MOV     ?V0 + 1,R3
   \   000013   8C..         MOV     ?V0 + 2,R4
   \   000015   8D..         MOV     ?V0 + 3,R5
    466                
    467            if( macSrcMatchAddrMode == SADDR_MODE_SHORT )
   \   000017   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   6402         XRL     A,#0x2
   \   00001D   75..01       MOV     ?V0 + 4,#0x1
   \   000020   75..00       MOV     ?V0 + 5,#0x0
   \   000023   703C         JNZ     ??macSrcMatchSetPendEnBit_0
    468            {
    469              enable |= ( 0x01 << index );
    470              osal_buffer_uint24( buf, enable );
   \   000025                ; Setup parameters for call to function osal_buffer_uint24
   \   000025   EE           MOV     A,R6
   \   000026   78..         MOV     R0,#?V0 + 4
   \   000028   12....       LCALL   ?S_SHL
   \   00002B   E5..         MOV     A,?V0 + 5
   \   00002D   33           RLC     A
   \   00002E   95E0         SUBB    A,0xE0 /* A   */
   \   000030   F5..         MOV     ?V0 + 6,A
   \   000032   F5..         MOV     ?V0 + 7,A
   \   000034   78..         MOV     R0,#?V0 + 0
   \   000036   79..         MOV     R1,#?V0 + 4
   \   000038   12....       LCALL   ?L_IOR
   \   00003B   78..         MOV     R0,#?V0 + 0
   \   00003D   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   000040   7404         MOV     A,#0x4
   \   000042   12....       LCALL   ?XSTACK_DISP0_8
   \   000045   AA82         MOV     R2,DPL
   \   000047   AB83         MOV     R3,DPH
   \   000049   12....       LCALL   ??osal_buffer_uint24?relay
   \   00004C   7404         MOV     A,#0x4
   \   00004E   12....       LCALL   ?DEALLOC_XSTACK8
    471              MAC_RADIO_SRC_MATCH_SET_SHORTPENDEN( buf );
   \   000051                ; Setup parameters for call to function macMemWriteRam
   \   000051   7903         MOV     R1,#0x3
   \   000053   85..82       MOV     DPL,?XSP + 0
   \   000056   85..83       MOV     DPH,?XSP + 1
   \   000059   AC82         MOV     R4,DPL
   \   00005B   AD83         MOV     R5,DPH
   \   00005D   7A67         MOV     R2,#0x67
   \   00005F   803C         SJMP    ??macSrcMatchSetPendEnBit_1
    472            }
    473            else
    474            {
    475              enable |= ( 0x01 << ( index * 2 ) );
    476              osal_buffer_uint24( buf, enable );
   \                     ??macSrcMatchSetPendEnBit_0:
   \   000061                ; Setup parameters for call to function osal_buffer_uint24
   \   000061   EE           MOV     A,R6
   \   000062   C3           CLR     C
   \   000063   33           RLC     A
   \   000064   78..         MOV     R0,#?V0 + 4
   \   000066   12....       LCALL   ?S_SHL
   \   000069   E5..         MOV     A,?V0 + 5
   \   00006B   33           RLC     A
   \   00006C   95E0         SUBB    A,0xE0 /* A   */
   \   00006E   F5..         MOV     ?V0 + 6,A
   \   000070   F5..         MOV     ?V0 + 7,A
   \   000072   78..         MOV     R0,#?V0 + 0
   \   000074   79..         MOV     R1,#?V0 + 4
   \   000076   12....       LCALL   ?L_IOR
   \   000079   78..         MOV     R0,#?V0 + 0
   \   00007B   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   00007E   7404         MOV     A,#0x4
   \   000080   12....       LCALL   ?XSTACK_DISP0_8
   \   000083   AA82         MOV     R2,DPL
   \   000085   AB83         MOV     R3,DPH
   \   000087   12....       LCALL   ??osal_buffer_uint24?relay
   \   00008A   7404         MOV     A,#0x4
   \   00008C   12....       LCALL   ?DEALLOC_XSTACK8
    477              MAC_RADIO_SRC_MATCH_SET_EXTPENDEN( buf );
   \   00008F                ; Setup parameters for call to function macMemWriteRam
   \   00008F   7903         MOV     R1,#0x3
   \   000091   85..82       MOV     DPL,?XSP + 0
   \   000094   85..83       MOV     DPH,?XSP + 1
   \   000097   AC82         MOV     R4,DPL
   \   000099   AD83         MOV     R5,DPH
   \   00009B   7A64         MOV     R2,#0x64
   \                     ??macSrcMatchSetPendEnBit_1:
   \   00009D   7B61         MOV     R3,#0x61
   \   00009F   12....       LCALL   ??macMemWriteRam?relay
    478            }
    479          }
   \   0000A2   7403         MOV     A,#0x3
   \   0000A4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A7   7F08         MOV     R7,#0x8
   \   0000A9   02....       LJMP    ?BANKED_LEAVE_XDATA
    480          
    481          /*********************************************************************
    482           * @fn          macSrcMatchSetEnableBit
    483           *
    484           * @brief       Set or clear the enable bit in the SRCMATCH EN register
    485           *
    486           * @param       index - index of the entry in the source address table
    487           * @param       option - true (set the enable bit), or false (clear the enable bit)
    488           *
    489           * @return      none
    490           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    491          static void macSrcMatchSetEnableBit( uint8 index, bool option )
   \                     macSrcMatchSetEnableBit:
    492          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   \   000008   FF           MOV     R7,A
    493            uint24 enable;  
    494            
    495            enable = MAC_RADIO_SRC_MATCH_GET_EN(); 
   \   000009                ; Setup parameters for call to function macSrcMatchGetEnableBit
   \   000009   12....       LCALL   ??macSrcMatchGetEnableBit?relay
   \   00000C   8A..         MOV     ?V0 + 4,R2
   \   00000E   8B..         MOV     ?V0 + 5,R3
   \   000010   8C..         MOV     ?V0 + 6,R4
   \   000012   8D..         MOV     ?V0 + 7,R5
    496                
    497            if( option == TRUE )
   \   000014   7401         MOV     A,#0x1
   \   000016   6F           XRL     A,R7
   \   000017   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   00001A   7044         JNZ     ??macSrcMatchSetEnableBit_0
    498            {
    499              if( macSrcMatchAddrMode == SADDR_MODE_SHORT )
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6402         XRL     A,#0x2
   \   00001F   75..01       MOV     ?V0 + 0,#0x1
   \   000022   75..00       MOV     ?V0 + 1,#0x0
   \   000025   701F         JNZ     ??macSrcMatchSetEnableBit_1
    500              {
    501                enable |= ( 0x01 << index );
    502                MAC_RADIO_SRC_MATCH_SET_SHORTEN( enable );
   \   000027                ; Setup parameters for call to function osal_buffer_uint24
   \   000027   EE           MOV     A,R6
   \   000028   78..         MOV     R0,#?V0 + 0
   \   00002A   12....       LCALL   ?S_SHL
   \   00002D   E5..         MOV     A,?V0 + 1
   \   00002F   33           RLC     A
   \   000030   95E0         SUBB    A,0xE0 /* A   */
   \   000032   F5..         MOV     ?V0 + 2,A
   \   000034   F5..         MOV     ?V0 + 3,A
   \   000036   78..         MOV     R0,#?V0 + 4
   \   000038   79..         MOV     R1,#?V0 + 0
   \   00003A   12....       LCALL   ?L_IOR
   \                     ??macSrcMatchSetEnableBit_2:
   \   00003D   78..         MOV     R0,#?V0 + 4
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   000042   7A83         MOV     R2,#-0x7d
   \   000044   806C         SJMP    ??macSrcMatchSetEnableBit_3
    503              }
    504              else
    505              {
    506                enable |= ( 0x01 << ( index * 2 ) );
    507                MAC_RADIO_SRC_MATCH_SET_EXTEN( enable );
   \                     ??macSrcMatchSetEnableBit_1:
   \   000046                ; Setup parameters for call to function osal_buffer_uint24
   \   000046   EE           MOV     A,R6
   \   000047   C3           CLR     C
   \   000048   33           RLC     A
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?S_SHL
   \   00004E   E5..         MOV     A,?V0 + 1
   \   000050   33           RLC     A
   \   000051   95E0         SUBB    A,0xE0 /* A   */
   \   000053   F5..         MOV     ?V0 + 2,A
   \   000055   F5..         MOV     ?V0 + 3,A
   \   000057   78..         MOV     R0,#?V0 + 4
   \   000059   79..         MOV     R1,#?V0 + 0
   \   00005B   12....       LCALL   ?L_IOR
   \   00005E   804B         SJMP    ??macSrcMatchSetEnableBit_4
    508              }
    509            }
    510            else
    511            {
    512              if( macSrcMatchAddrMode == SADDR_MODE_SHORT )
   \                     ??macSrcMatchSetEnableBit_0:
   \   000060   E0           MOVX    A,@DPTR
   \   000061   6402         XRL     A,#0x2
   \   000063   75..01       MOV     ?V0 + 0,#0x1
   \   000066   75..00       MOV     ?V0 + 1,#0x0
   \   000069   7020         JNZ     ??macSrcMatchSetEnableBit_5
    513              {
    514                enable &= ~( 0x01 << index );
    515                MAC_RADIO_SRC_MATCH_SET_SHORTEN( enable );
   \   00006B                ; Setup parameters for call to function osal_buffer_uint24
   \   00006B   EE           MOV     A,R6
   \   00006C   78..         MOV     R0,#?V0 + 0
   \   00006E   12....       LCALL   ?S_SHL
   \   000071   E5..         MOV     A,?V0 + 0
   \   000073   F4           CPL     A
   \   000074   F5..         MOV     ?V0 + 0,A
   \   000076   E5..         MOV     A,?V0 + 1
   \   000078   F4           CPL     A
   \   000079   F5..         MOV     ?V0 + 1,A
   \   00007B   33           RLC     A
   \   00007C   95E0         SUBB    A,0xE0 /* A   */
   \   00007E   F5..         MOV     ?V0 + 2,A
   \   000080   F5..         MOV     ?V0 + 3,A
   \   000082   78..         MOV     R0,#?V0 + 4
   \   000084   79..         MOV     R1,#?V0 + 0
   \   000086   12....       LCALL   ?L_AND
   \   000089   80B2         SJMP    ??macSrcMatchSetEnableBit_2
    516              }
    517              else
    518              {
    519                enable &= ~( 0x01 << ( index * 2 ) );
    520                MAC_RADIO_SRC_MATCH_SET_EXTEN( enable );
   \                     ??macSrcMatchSetEnableBit_5:
   \   00008B                ; Setup parameters for call to function osal_buffer_uint24
   \   00008B   EE           MOV     A,R6
   \   00008C   C3           CLR     C
   \   00008D   33           RLC     A
   \   00008E   78..         MOV     R0,#?V0 + 0
   \   000090   12....       LCALL   ?S_SHL
   \   000093   E5..         MOV     A,?V0 + 0
   \   000095   F4           CPL     A
   \   000096   F5..         MOV     ?V0 + 0,A
   \   000098   E5..         MOV     A,?V0 + 1
   \   00009A   F4           CPL     A
   \   00009B   F5..         MOV     ?V0 + 1,A
   \   00009D   33           RLC     A
   \   00009E   95E0         SUBB    A,0xE0 /* A   */
   \   0000A0   F5..         MOV     ?V0 + 2,A
   \   0000A2   F5..         MOV     ?V0 + 3,A
   \   0000A4   78..         MOV     R0,#?V0 + 4
   \   0000A6   79..         MOV     R1,#?V0 + 0
   \   0000A8   12....       LCALL   ?L_AND
   \                     ??macSrcMatchSetEnableBit_4:
   \   0000AB   78..         MOV     R0,#?V0 + 4
   \   0000AD   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   0000B0   7A86         MOV     R2,#-0x7a
   \                     ??macSrcMatchSetEnableBit_3:
   \   0000B2   7B61         MOV     R3,#0x61
   \   0000B4   12....       LCALL   ??osal_buffer_uint24?relay
   \   0000B7   7404         MOV     A,#0x4
   \   0000B9   12....       LCALL   ?DEALLOC_XSTACK8
    521              }
    522          
    523            }
    524          }
   \   0000BC   7F08         MOV     R7,#0x8
   \   0000BE   02....       LJMP    ?BANKED_LEAVE_XDATA
    525          
    526          /*********************************************************************
    527           * @fn          macSrcMatchCheckEnableBit
    528           *
    529           * @brief       Check the enable bit in the source address table
    530           *
    531           * @param       index - index of the entry in the source address table
    532           *
    533           * @return      TRUE or FALSE
    534           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    535          static bool macSrcMatchCheckEnableBit( uint8 index )
   \                     macSrcMatchCheckEnableBit:
    536          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    537            uint24 enable;
    538            
    539            if( macSrcMatchAddrMode == SADDR_MODE_EXT )
   \   000007   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   6403         XRL     A,#0x3
   \   00000D   7004         JNZ     ??macSrcMatchCheckEnableBit_0
    540            {
    541              index *= 2;
   \   00000F   EE           MOV     A,R6
   \   000010   C3           CLR     C
   \   000011   33           RLC     A
   \   000012   FE           MOV     R6,A
    542            }
    543            
    544            enable = MAC_RADIO_SRC_MATCH_GET_EN();
    545               
    546            if( enable & ( 0x01 << index ) )
   \                     ??macSrcMatchCheckEnableBit_0:
   \   000013                ; Setup parameters for call to function macSrcMatchGetEnableBit
   \   000013   12....       LCALL   ??macSrcMatchGetEnableBit?relay
   \   000016   8A..         MOV     ?V0 + 4,R2
   \   000018   8B..         MOV     ?V0 + 5,R3
   \   00001A   8C..         MOV     ?V0 + 6,R4
   \   00001C   8D..         MOV     ?V0 + 7,R5
   \   00001E   75..01       MOV     ?V0 + 0,#0x1
   \   000021   75..00       MOV     ?V0 + 1,#0x0
   \   000024   EE           MOV     A,R6
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?S_SHL
   \   00002A   E5..         MOV     A,?V0 + 1
   \   00002C   33           RLC     A
   \   00002D   95E0         SUBB    A,0xE0 /* A   */
   \   00002F   F5..         MOV     ?V0 + 2,A
   \   000031   F5..         MOV     ?V0 + 3,A
   \   000033   78..         MOV     R0,#?V0 + 4
   \   000035   79..         MOV     R1,#?V0 + 0
   \   000037   12....       LCALL   ?L_AND
   \   00003A   E5..         MOV     A,?V0 + 4
   \   00003C   45..         ORL     A,?V0 + 5
   \   00003E   45..         ORL     A,?V0 + 6
   \   000040   45..         ORL     A,?V0 + 7
   \   000042   6004         JZ      ??macSrcMatchCheckEnableBit_1
    547            {
    548              return TRUE;
   \   000044   7901         MOV     R1,#0x1
   \   000046   8002         SJMP    ??macSrcMatchCheckEnableBit_2
    549            }
    550          
    551            return FALSE; 
   \                     ??macSrcMatchCheckEnableBit_1:
   \   000048   7900         MOV     R1,#0x0
   \                     ??macSrcMatchCheckEnableBit_2:
   \   00004A   7F08         MOV     R7,#0x8
   \   00004C   02....       LJMP    ?BANKED_LEAVE_XDATA
    552          }
    553           
    554          
    555          /*********************************************************************
    556           * @fn          macSrcMatchGetEnableBit
    557           *
    558           * @brief       Return the SRCMATCH enable bitmap
    559           *
    560           * @param       none
    561           *
    562           * @return      uint24 - 24 bits bitmap
    563           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    564          static uint24 macSrcMatchGetEnableBit( void )
   \                     macSrcMatchGetEnableBit:
    565          { 
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    566            uint8 buf[MAC_SRCMATCH_ENABLE_BITMAP_LEN];
    567            
    568            if( macSrcMatchAddrMode == SADDR_MODE_SHORT )
   \   000009   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7903         MOV     R1,#0x3
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   AC82         MOV     R4,DPL
   \   000019   AD83         MOV     R5,DPH
   \   00001B   7004         JNZ     ??macSrcMatchGetEnableBit_0
    569            {
    570              MAC_RADIO_GET_SRC_SHORTEN( buf );
   \   00001D                ; Setup parameters for call to function macMemReadRam
   \   00001D   7A83         MOV     R2,#-0x7d
   \   00001F   8002         SJMP    ??macSrcMatchGetEnableBit_1
    571            }
    572            else
    573            {
    574              MAC_RADIO_GET_SRC_EXTEN( buf );
   \                     ??macSrcMatchGetEnableBit_0:
   \   000021                ; Setup parameters for call to function macMemReadRam
   \   000021   7A86         MOV     R2,#-0x7a
   \                     ??macSrcMatchGetEnableBit_1:
   \   000023   7B61         MOV     R3,#0x61
   \   000025   12....       LCALL   ??macMemReadRam?relay
    575            }
    576            
    577            return osal_build_uint32( buf, MAC_SRCMATCH_ENABLE_BITMAP_LEN );
   \   000028                ; Setup parameters for call to function osal_build_uint32
   \   000028   7903         MOV     R1,#0x3
   \   00002A   85..82       MOV     DPL,?XSP + 0
   \   00002D   85..83       MOV     DPH,?XSP + 1
   \   000030   AA82         MOV     R2,DPL
   \   000032   AB83         MOV     R3,DPH
   \   000034   12....       LCALL   ??osal_build_uint32?relay
   \   000037   7403         MOV     A,#0x3
   \   000039   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003C   D083         POP     DPH
   \   00003E   D082         POP     DPL
   \   000040   02....       LJMP    ?BRET
    578          
    579          }
    580          
    581          
    582          /*********************************************************************
    583           * @fn          macSrcMatchGetPendEnBit
    584           *
    585           * @brief       Return the SRCMATCH Pend enable bitmap
    586           *
    587           * @param       none
    588           *
    589           * @return      uint24 - 24 bits bitmap
    590           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    591          static uint24 macSrcMatchGetPendEnBit( void )
   \                     macSrcMatchGetPendEnBit:
    592          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    593            uint8 buf[MAC_SRCMATCH_ENABLE_BITMAP_LEN];
    594          
    595            if( macSrcMatchAddrMode == SADDR_MODE_SHORT )
   \   000009   90....       MOV     DPTR,#macSrcMatchAddrMode
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7903         MOV     R1,#0x3
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   AC82         MOV     R4,DPL
   \   000019   AD83         MOV     R5,DPH
   \   00001B   7004         JNZ     ??macSrcMatchGetPendEnBit_0
    596            {
    597              MAC_RADIO_GET_SRC_SHORTPENDEN( buf );
   \   00001D                ; Setup parameters for call to function macMemReadRam
   \   00001D   7A67         MOV     R2,#0x67
   \   00001F   8002         SJMP    ??macSrcMatchGetPendEnBit_1
    598            }
    599            else
    600            {
    601              MAC_RADIO_GET_SRC_EXTENPEND( buf );
   \                     ??macSrcMatchGetPendEnBit_0:
   \   000021                ; Setup parameters for call to function macMemReadRam
   \   000021   7A64         MOV     R2,#0x64
   \                     ??macSrcMatchGetPendEnBit_1:
   \   000023   7B61         MOV     R3,#0x61
   \   000025   12....       LCALL   ??macMemReadRam?relay
    602            }
    603            
    604            return osal_build_uint32( buf, MAC_SRCMATCH_ENABLE_BITMAP_LEN );
   \   000028                ; Setup parameters for call to function osal_build_uint32
   \   000028   7903         MOV     R1,#0x3
   \   00002A   85..82       MOV     DPL,?XSP + 0
   \   00002D   85..83       MOV     DPH,?XSP + 1
   \   000030   AA82         MOV     R2,DPL
   \   000032   AB83         MOV     R3,DPH
   \   000034   12....       LCALL   ??osal_build_uint32?relay
   \   000037   7403         MOV     A,#0x3
   \   000039   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003C   D083         POP     DPH
   \   00003E   D082         POP     DPL
   \   000040   02....       LJMP    ?BRET
    605          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for macSrcMatchAddrMode>`:
   \   000000   02           DB 2

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MAC_SrcMatchEnable?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MAC_SrcMatchEnable

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MAC_SrcMatchAddEntry?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MAC_SrcMatchAddEntry

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MAC_SrcMatchDeleteEntry?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MAC_SrcMatchDeleteEntry

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MAC_SrcMatchAckAllPending?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MAC_SrcMatchAckAllPending

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MAC_SrcMatchCheckAllPending?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MAC_SrcMatchCheckAllPending

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MAC_SrcMatchCheckResult?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MAC_SrcMatchCheckResult

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macSrcMatchFindEmptyEntry?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macSrcMatchFindEmptyEntry

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macSrcMatchCheckSrcAddr?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macSrcMatchCheckSrcAddr

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macSrcMatchSetPendEnBit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macSrcMatchSetPendEnBit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macSrcMatchSetEnableBit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macSrcMatchSetEnableBit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macSrcMatchCheckEnableBit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macSrcMatchCheckEnableBit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macSrcMatchGetEnableBit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macSrcMatchGetEnableBit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macSrcMatchGetPendEnBit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macSrcMatchGetPendEnBit
    606          
    607          

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     MAC_SrcMatchAckAllPending          2      0      0
     MAC_SrcMatchAddEntry               1      0     18
       -> macSrcMatchCheckSrcAddr       0      0     36
       -> macSrcMatchFindEmptyEntry     0      0     36
       -> macMemWriteRam                0      0     36
       -> macMemWriteRam                0      0     36
       -> macSrcMatchSetPendEnBit       0      0     36
       -> macSrcMatchSetEnableBit       0      0     36
     MAC_SrcMatchCheckAllPending        2      0      0
     MAC_SrcMatchCheckResult            2      0      0
     MAC_SrcMatchDeleteEntry            2      0      0
       -> macSrcMatchCheckSrcAddr       4      0      0
       -> macSrcMatchSetEnableBit       4      0      0
     MAC_SrcMatchEnable                 2      0      0
     macSrcMatchCheckEnableBit          0      0     42
       -> macSrcMatchGetEnableBit       0      0     32
     macSrcMatchCheckSrcAddr            1      0     47
       -> macSrcMatchCheckEnableBit     0      0     52
       -> macMemReadRam                 0      0     52
       -> osal_memcmp                   0      0     58
     macSrcMatchFindEmptyEntry          0      0     34
       -> macSrcMatchGetEnableBit       0      0     32
     macSrcMatchGetEnableBit            2      0     19
       -> macMemReadRam                 4      0      6
       -> macMemReadRam                 4      0      6
       -> osal_build_uint32             4      0      6
     macSrcMatchGetPendEnBit            2      0     22
       -> macMemReadRam                 4      0      6
       -> macMemReadRam                 4      0      6
       -> osal_build_uint32             4      0      6
     macSrcMatchSetEnableBit            0      0     38
       -> macSrcMatchGetEnableBit       0      0     32
       -> osal_buffer_uint24            0      0     40
       -> osal_buffer_uint24            0      0     40
       -> osal_buffer_uint24            0      0     40
       -> osal_buffer_uint24            0      0     40
     macSrcMatchSetPendEnBit            0      0     41
       -> macSrcMatchGetPendEnBit       0      0     38
       -> osal_buffer_uint24            0      0     46
       -> macMemWriteRam                0      0     38
       -> osal_buffer_uint24            0      0     46
       -> macMemWriteRam                0      0     38


   Segment part sizes:

     Function/Label                         Bytes
     --------------                         -----
     macSrcMatchIsEnabled                      1
     macSrcMatchMaxNumEntries                  1
     macSrcMatchAddrMode                       1
     macSrcMatchIsAckAllPending                1
     MAC_SrcMatchEnable                       92
     MAC_SrcMatchAddEntry                    213
     MAC_SrcMatchDeleteEntry                  55
     MAC_SrcMatchAckAllPending                39
     MAC_SrcMatchCheckAllPending              25
     MAC_SrcMatchCheckResult                  30
     macSrcMatchFindEmptyEntry               154
     macSrcMatchCheckSrcAddr                 209
     macSrcMatchSetPendEnBit                 172
     macSrcMatchSetEnableBit                 193
     macSrcMatchCheckEnableBit                79
     macSrcMatchGetEnableBit                  67
     macSrcMatchGetPendEnBit                  67
     ?<Initializer for macSrcMatchAddrMode>    1
     ??MAC_SrcMatchEnable?relay                6
     ??MAC_SrcMatchAddEntry?relay              6
     ??MAC_SrcMatchDeleteEntry?relay           6
     ??MAC_SrcMatchAckAllPending?relay         6
     ??MAC_SrcMatchCheckAllPending?relay       6
     ??MAC_SrcMatchCheckResult?relay           6
     ??macSrcMatchFindEmptyEntry?relay         6
     ??macSrcMatchCheckSrcAddr?relay           6
     ??macSrcMatchSetPendEnBit?relay           6
     ??macSrcMatchSetEnableBit?relay           6
     ??macSrcMatchCheckEnableBit?relay         6
     ??macSrcMatchGetEnableBit?relay           6
     ??macSrcMatchGetPendEnBit?relay           6

 
 1 395 bytes in segment BANKED_CODE
    78 bytes in segment BANK_RELAYS
     1 byte  in segment XDATA_I
     1 byte  in segment XDATA_ID
     3 bytes in segment XDATA_Z
 
 1 474 bytes of CODE  memory
     4 bytes of XDATA memory

Errors: none
Warnings: none
